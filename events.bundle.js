/*! For license information please see events.bundle.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++i)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const s=t[e],r=e+1<t.length,o=r?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(l=64)),i.push(n[u],n[h],n[l],n[d])}return i.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(r>>10)),e[i++]=String.fromCharCode(56320+(1023&r))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],r=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==r||null==o||null==a)throw Error();const c=s<<2|r>>4;if(i.push(c),64!==o){const t=r<<4&240|o>>2;if(i.push(t),64!==a){const t=o<<6&192|a;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},i=function(t){return function(t){const i=e(t);return n.encodeByteArray(i,!0)}(t).replace(/\./g,"")};class s{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function r(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function o(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(r())}function a(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function c(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function u(){const t=r();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function h(){return"object"==typeof indexedDB}function l(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class d extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],r=s?function(t,e){return t.replace(p,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new d(i,o,n)}}const p=/\{\$([^}]+)}/g;function g(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(m(n)&&m(r)){if(!g(n,r))return!1}else if(n!==r)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function m(t){return null!==t&&"object"==typeof t}function y(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function v(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[n,i]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(i)}})),e}function w(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}class I{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,n){let i;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");i=function(t,e){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:n},void 0===i.next&&(i.next=b),void 0===i.error&&(i.error=b),void 0===i.complete&&(i.complete=b);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(t){}})),this.observers.push(i),s}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function b(){}function T(t,e=1e3,n=2){const i=e*Math.pow(n,t),s=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+s)}function _(t){return t&&t._delegate?t._delegate:t}class E{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const S="[DEFAULT]";class k{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new s;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:S})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===S?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:S:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class C{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new k(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const A=[];var N,R;(R=N||(N={}))[R.DEBUG=0]="DEBUG",R[R.VERBOSE=1]="VERBOSE",R[R.INFO=2]="INFO",R[R.WARN=3]="WARN",R[R.ERROR=4]="ERROR",R[R.SILENT=5]="SILENT";const D={debug:N.DEBUG,verbose:N.VERBOSE,info:N.INFO,warn:N.WARN,error:N.ERROR,silent:N.SILENT},O=N.INFO,P={[N.DEBUG]:"log",[N.VERBOSE]:"log",[N.INFO]:"info",[N.WARN]:"warn",[N.ERROR]:"error"},L=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),s=P[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${t.name}:`,...n)};class M{constructor(t){this.name=t,this._logLevel=O,this._logHandler=L,this._userLogHandler=null,A.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in N))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?D[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,N.DEBUG,...t),this._logHandler(this,N.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,N.VERBOSE,...t),this._logHandler(this,N.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,N.INFO,...t),this._logHandler(this,N.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,N.WARN,...t),this._logHandler(this,N.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,N.ERROR,...t),this._logHandler(this,N.ERROR,...t)}}let x,F;const U=new WeakMap,V=new WeakMap,j=new WeakMap,B=new WeakMap,q=new WeakMap;let $={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return V.get(t);if("objectStoreNames"===e)return t.objectStoreNames||j.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return K(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function z(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(F||(F=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(H(this),t),K(U.get(this))}:function(...t){return K(e.apply(H(this),t))}:function(t,...n){const i=e.call(H(this),t,...n);return j.set(i,t.sort?t.sort():[t]),K(i)}:(t instanceof IDBTransaction&&function(t){if(V.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));V.set(t,e)}(t),n=t,(x||(x=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((t=>n instanceof t))?new Proxy(t,$):t);var e,n}function K(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(K(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&U.set(e,t)})).catch((()=>{})),q.set(e,t),e}(t);if(B.has(t))return B.get(t);const e=z(t);return e!==t&&(B.set(t,e),q.set(e,t)),e}const H=t=>q.get(t);function G(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=K(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(K(o.result),t.oldVersion,t.newVersion,K(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}const W=["get","getKey","getAll","getAllKeys","count"],Q=["put","add","delete","clear"],X=new Map;function J(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(X.get(e))return X.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=Q.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!W.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return X.set(e,r),r}var Y;Y=$,$={...Y,get:(t,e,n)=>J(t,e)||Y.get(t,e,n),has:(t,e)=>!!J(t,e)||Y.has(t,e)};class Z{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const tt="@firebase/app",et="0.7.28",nt=new M("@firebase/app"),it={[tt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},st=new Map,rt=new Map;function ot(t,e){try{t.container.addComponent(e)}catch(n){nt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function at(t){const e=t.name;if(rt.has(e))return nt.debug(`There were multiple attempts to register component ${e}.`),!1;rt.set(e,t);for(const e of st.values())ot(e,t);return!0}function ct(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const ut=new f("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});class ht{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new E("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ut.create("app-deleted",{appName:this._name})}}const lt="9.9.0";function dt(t="[DEFAULT]"){const e=st.get(t);if(!e)throw ut.create("no-app",{appName:t});return e}function ft(t,e,n){var i;let s=null!==(i=it[t])&&void 0!==i?i:t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void nt.warn(t.join(" "))}at(new E(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const pt="firebase-heartbeat-store";let gt=null;function mt(){return gt||(gt=G("firebase-heartbeat-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(pt)}}).catch((t=>{throw ut.create("storage-open",{originalErrorMessage:t.message})}))),gt}async function yt(t,e){var n;try{const n=(await mt()).transaction(pt,"readwrite"),i=n.objectStore(pt);return await i.put(e,vt(t)),n.done}catch(t){throw ut.create("storage-set",{originalErrorMessage:null===(n=t)||void 0===n?void 0:n.message})}}function vt(t){return`${t.name}!${t.options.appId}`}class wt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new bt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=It();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=It(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),Tt(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Tt(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function It(){return(new Date).toISOString().substring(0,10)}class bt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!h()&&l().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){var e;try{return(await mt()).transaction(pt).objectStore(pt).get(vt(t))}catch(t){throw ut.create("storage-get",{originalErrorMessage:null===(e=t)||void 0===e?void 0:e.message})}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return yt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Tt(t){return i(JSON.stringify({version:2,heartbeats:t})).length}at(new E("platform-logger",(t=>new Z(t)),"PRIVATE")),at(new E("heartbeat",(t=>new wt(t)),"PRIVATE")),ft(tt,et,""),ft(tt,et,"esm2017"),ft("fire-js","");var _t,Et="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:{},St={},kt=kt||{},Ct=Et||self;function At(){}function Nt(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Rt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Dt="closure_uid_"+(1e9*Math.random()>>>0),Ot=0;function Pt(t,e,n){return t.call.apply(t.bind,arguments)}function Lt(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Mt(t,e,n){return(Mt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Pt:Lt).apply(null,arguments)}function xt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Ft(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return e.prototype[n].apply(t,s)}}function Ut(){this.s=this.s,this.o=this.o}var Vt={};Ut.prototype.s=!1,Ut.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,Dt)&&t[Dt]||(t[Dt]=++Ot)}(this);delete Vt[t]}},Ut.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const jt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Bt=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){const i=t.length,s="string"==typeof t?t.split(""):t;for(let r=0;r<i;r++)r in s&&e.call(n,s[r],r,t)};function qt(t){return Array.prototype.concat.apply([],arguments)}function $t(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function zt(t){return/^[\s\xa0]*$/.test(t)}var Kt,Ht=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Gt(t,e){return-1!=t.indexOf(e)}function Wt(t,e){return t<e?-1:t>e?1:0}t:{var Qt=Ct.navigator;if(Qt){var Xt=Qt.userAgent;if(Xt){Kt=Xt;break t}}Kt=""}function Jt(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function Yt(t){const e={};for(const n in t)e[n]=t[n];return e}var Zt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<Zt.length;e++)n=Zt[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function ee(t){return ee[" "](t),t}ee[" "]=At;var ne,ie,se=Gt(Kt,"Opera"),re=Gt(Kt,"Trident")||Gt(Kt,"MSIE"),oe=Gt(Kt,"Edge"),ae=oe||re,ce=Gt(Kt,"Gecko")&&!(Gt(Kt.toLowerCase(),"webkit")&&!Gt(Kt,"Edge"))&&!(Gt(Kt,"Trident")||Gt(Kt,"MSIE"))&&!Gt(Kt,"Edge"),ue=Gt(Kt.toLowerCase(),"webkit")&&!Gt(Kt,"Edge");function he(){var t=Ct.document;return t?t.documentMode:void 0}t:{var le="",de=(ie=Kt,ce?/rv:([^\);]+)(\)|;)/.exec(ie):oe?/Edge\/([\d\.]+)/.exec(ie):re?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ie):ue?/WebKit\/(\S+)/.exec(ie):se?/(?:Version)[ \/]?(\S+)/.exec(ie):void 0);if(de&&(le=de?de[1]:""),re){var fe=he();if(null!=fe&&fe>parseFloat(le)){ne=String(fe);break t}}ne=le}var pe,ge={};function me(){return t=ge,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let t=0;const e=Ht(String(ne)).split("."),n=Ht("9").split("."),i=Math.max(e.length,n.length);for(let o=0;0==t&&o<i;o++){var s=e[o]||"",r=n[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==s[0].length&&0==r[0].length)break;t=Wt(0==s[1].length?0:parseInt(s[1],10),0==r[1].length?0:parseInt(r[1],10))||Wt(0==s[2].length,0==r[2].length)||Wt(s[2],r[2]),s=s[3],r=r[3]}while(0==t)}return 0<=t}();var t}Ct.document&&re?pe=he()||parseInt(ne,10)||void 0:pe=void 0;var ye=pe,ve=function(){if(!Ct.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Ct.addEventListener("test",At,e),Ct.removeEventListener("test",At,e)}catch(t){}return t}();function we(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Ie(t,e){if(we.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ce){t:{try{ee(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:be[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Ie.Z.h.call(this)}}we.prototype.h=function(){this.defaultPrevented=!0},Ft(Ie,we);var be={2:"touch",3:"pen",4:"mouse"};Ie.prototype.h=function(){Ie.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Te="closure_listenable_"+(1e6*Math.random()|0),_e=0;function Ee(t,e,n,i,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.ia=s,this.key=++_e,this.ca=this.fa=!1}function Se(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function ke(t){this.src=t,this.g={},this.h=0}function Ce(t,e){var n=e.type;if(n in t.g){var i,s=t.g[n],r=jt(s,e);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Se(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function Ae(t,e,n,i){for(var s=0;s<t.length;++s){var r=t[s];if(!r.ca&&r.listener==e&&r.capture==!!n&&r.ia==i)return s}return-1}ke.prototype.add=function(t,e,n,i,s){var r=t.toString();(t=this.g[r])||(t=this.g[r]=[],this.h++);var o=Ae(t,e,i,s);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new Ee(e,this.src,r,!!i,s)).fa=n,t.push(e)),e};var Ne="closure_lm_"+(1e6*Math.random()|0),Re={};function De(t,e,n,i,s){if(i&&i.once)return Pe(t,e,n,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)De(t,e[r],n,i,s);return null}return n=je(n),t&&t[Te]?t.N(e,n,Rt(i)?!!i.capture:!!i,s):Oe(t,e,n,!1,i,s)}function Oe(t,e,n,i,s,r){if(!e)throw Error("Invalid event type");var o=Rt(s)?!!s.capture:!!s,a=Ue(t);if(a||(t[Ne]=a=new ke(t)),(n=a.add(e,n,i,o,r)).proxy)return n;if(i=function(){var t=Fe;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)ve||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),i,s);else if(t.attachEvent)t.attachEvent(xe(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function Pe(t,e,n,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)Pe(t,e[r],n,i,s);return null}return n=je(n),t&&t[Te]?t.O(e,n,Rt(i)?!!i.capture:!!i,s):Oe(t,e,n,!0,i,s)}function Le(t,e,n,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)Le(t,e[r],n,i,s);else i=Rt(i)?!!i.capture:!!i,n=je(n),t&&t[Te]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=Ae(r=t.g[e],n,i,s))&&(Se(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[e],t.h--))):t&&(t=Ue(t))&&(e=t.g[e.toString()],t=-1,e&&(t=Ae(e,n,i,s)),(n=-1<t?e[t]:null)&&Me(n))}function Me(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[Te])Ce(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(xe(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=Ue(e))?(Ce(n,t),0==n.h&&(n.src=null,e[Ne]=null)):Se(t)}}}function xe(t){return t in Re?Re[t]:Re[t]="on"+t}function Fe(t,e){if(t.ca)t=!0;else{e=new Ie(e,this);var n=t.listener,i=t.ia||t.src;t.fa&&Me(t),t=n.call(i,e)}return t}function Ue(t){return(t=t[Ne])instanceof ke?t:null}var Ve="__closure_events_fn_"+(1e9*Math.random()>>>0);function je(t){return"function"==typeof t?t:(t[Ve]||(t[Ve]=function(e){return t.handleEvent(e)}),t[Ve])}function Be(){Ut.call(this),this.i=new ke(this),this.P=this,this.I=null}function qe(t,e){var n,i=t.I;if(i)for(n=[];i;i=i.I)n.push(i);if(t=t.P,i=e.type||e,"string"==typeof e)e=new we(e,t);else if(e instanceof we)e.target=e.target||t;else{var s=e;te(e=new we(i,t),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=e.g=n[r];s=$e(o,i,!0,e)&&s}if(s=$e(o=e.g=t,i,!0,e)&&s,s=$e(o,i,!1,e)&&s,n)for(r=0;r<n.length;r++)s=$e(o=e.g=n[r],i,!1,e)&&s}function $e(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&Ce(t.i,o),s=!1!==a.call(c,i)&&s}}return s&&!i.defaultPrevented}Ft(Be,Ut),Be.prototype[Te]=!0,Be.prototype.removeEventListener=function(t,e,n,i){Le(this,t,e,n,i)},Be.prototype.M=function(){if(Be.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)Se(n[i]);delete e.g[t],e.h--}}this.I=null},Be.prototype.N=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},Be.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var ze=Ct.JSON.stringify;function Ke(){var t=Ye;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var He,Ge=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new We),(t=>t.reset()));class We{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Qe(t){Ct.setTimeout((()=>{throw t}),0)}function Xe(t,e){He||function(){var t=Ct.Promise.resolve(void 0);He=function(){t.then(Ze)}}(),Je||(He(),Je=!0),Ye.add(t,e)}var Je=!1,Ye=new class{constructor(){this.h=this.g=null}add(t,e){const n=Ge.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function Ze(){for(var t;t=Ke();){try{t.h.call(t.g)}catch(t){Qe(t)}var e=Ge;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Je=!1}function tn(t,e){Be.call(this),this.h=t||1,this.g=e||Ct,this.j=Mt(this.kb,this),this.l=Date.now()}function en(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function nn(t,e,n){if("function"==typeof t)n&&(t=Mt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Mt(t.handleEvent,t)}return 2147483647<Number(e)?-1:Ct.setTimeout(t,e||0)}function sn(t){t.g=nn((()=>{t.g=null,t.i&&(t.i=!1,sn(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Ft(tn,Be),(_t=tn.prototype).da=!1,_t.S=null,_t.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),qe(this,"tick"),this.da&&(en(this),this.start()))}},_t.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},_t.M=function(){tn.Z.M.call(this),en(this),delete this.g};class rn extends Ut{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:sn(this)}M(){super.M(),this.g&&(Ct.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function on(t){Ut.call(this),this.h=t,this.g={}}Ft(on,Ut);var an=[];function cn(t,e,n,i){Array.isArray(n)||(n&&(an[0]=n.toString()),n=an);for(var s=0;s<n.length;s++){var r=De(e,n[s],i||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}}function un(t){Jt(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Me(t)}),t),t.g={}}function hn(){this.g=!0}function ln(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return ze(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}on.prototype.M=function(){on.Z.M.call(this),un(this)},on.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},hn.prototype.Aa=function(){this.g=!1},hn.prototype.info=function(){};var dn={},fn=null;function pn(){return fn=fn||new Be}function gn(t){we.call(this,dn.Ma,t)}function mn(t){const e=pn();qe(e,new gn(e,t))}function yn(t,e){we.call(this,dn.STAT_EVENT,t),this.stat=e}function vn(t){const e=pn();qe(e,new yn(e,t))}function wn(t,e){we.call(this,dn.Na,t),this.size=e}function In(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return Ct.setTimeout((function(){t()}),e)}dn.Ma="serverreachability",Ft(gn,we),dn.STAT_EVENT="statevent",Ft(yn,we),dn.Na="timingevent",Ft(wn,we);var bn={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Tn={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function _n(){}function En(t){return t.h||(t.h=t.i())}function Sn(){}_n.prototype.h=null;var kn,Cn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function An(){we.call(this,"d")}function Nn(){we.call(this,"c")}function Rn(){}function Dn(t,e,n,i){this.l=t,this.j=e,this.m=n,this.X=i||1,this.V=new on(this),this.P=Pn,t=ae?125:void 0,this.W=new tn(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new On}function On(){this.i=null,this.g="",this.h=!1}Ft(An,we),Ft(Nn,we),Ft(Rn,_n),Rn.prototype.g=function(){return new XMLHttpRequest},Rn.prototype.i=function(){return{}},kn=new Rn;var Pn=45e3,Ln={},Mn={};function xn(t,e,n){t.K=1,t.v=ri(Zn(e)),t.s=n,t.U=!0,Fn(t,null)}function Fn(t,e){t.F=Date.now(),Bn(t),t.A=Zn(t.v);var n=t.A,i=t.X;Array.isArray(i)||(i=[String(i)]),vi(n.h,"t",i),t.C=0,n=t.l.H,t.h=new On,t.g=vs(t.l,n?e:null,!t.s),0<t.O&&(t.L=new rn(Mt(t.Ia,t,t.g),t.O)),cn(t.V,t.g,"readystatechange",t.gb),e=t.H?Yt(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),mn(1),function(t,e,n,i,s,r){t.info((function(){if(t.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function Un(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Vn(t,e,n){let i,s=!0;for(;!t.I&&t.C<n.length;){if(i=jn(t,n),i==Mn){4==e&&(t.o=4,vn(14),s=!1),ln(t.j,t.m,null,"[Incomplete Response]");break}if(i==Ln){t.o=4,vn(15),ln(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}ln(t.j,t.m,i,null),Hn(t,i)}Un(t)&&i!=Mn&&i!=Ln&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,vn(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),hs(e),e.L=!0,vn(11))):(ln(t.j,t.m,n,"[Invalid Chunked Response]"),Kn(t),zn(t))}function jn(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?Mn:(n=Number(e.substring(n,i)),isNaN(n)?Ln:(i+=1)+n>e.length?Mn:(e=e.substr(i,n),t.C=i+n,e))}function Bn(t){t.Y=Date.now()+t.P,qn(t,t.P)}function qn(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=In(Mt(t.eb,t),e)}function $n(t){t.B&&(Ct.clearTimeout(t.B),t.B=null)}function zn(t){0==t.l.G||t.I||fs(t.l,t)}function Kn(t){$n(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,en(t.W),un(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Hn(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Ei(n.i,t)))if(n.I=t.N,!t.J&&Ei(n.i,t)&&3==n.G){try{var i=n.Ca.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;ds(n),es(n)}us(n),vn(18)}}else n.ta=s[1],0<n.ta-n.U&&37500>s[2]&&n.N&&0==n.A&&!n.v&&(n.v=In(Mt(n.ab,n),6e3));if(1>=_i(n.i)&&n.ka){try{n.ka()}catch(t){}n.ka=void 0}}else gs(n,11)}else if((t.J||n.g==t)&&ds(n),!zt(e))for(s=n.Ca.g.parse(e),e=0;e<s.length;e++){let u=s[e];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const e=u[3];null!=e&&(n.ma=e,n.h.info("VER="+n.ma));const s=u[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(i=1.5*h,n.K=i,n.h.info("backChannelRequestTimeoutMs_="+i)),i=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=i.i;!r.g&&(Gt(t,"spdy")||Gt(t,"quic")||Gt(t,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(Si(r,r.h),r.h=null))}if(i.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.sa=t,si(i.F,i.D,t))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=t;if((i=n).oa=ys(i,i.H?i.la:null,i.W),o.J){ki(i.i,o);var a=o,c=i.K;c&&a.setTimeout(c),a.B&&($n(a),Bn(a)),i.g=o}else cs(i);0<n.l.length&&ss(n)}else"stop"!=u[0]&&"close"!=u[0]||gs(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?gs(n,7):ts(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}mn(4)}catch(t){}}function Gn(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Nt(t)||"string"==typeof t)Bt(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(Nt(t)||"string"==typeof t){n=[];for(var i=t.length,s=0;s<i;s++)n.push(s)}else for(s in n=[],i=0,t)n[i++]=s;i=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(Nt(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),s=i.length;for(var r=0;r<s;r++)e.call(void 0,i[r],n&&n[r],t)}}function Wn(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var i=0;i<n;i+=2)this.set(arguments[i],arguments[i+1])}else if(t)if(t instanceof Wn)for(n=t.T(),i=0;i<n.length;i++)this.set(n[i],t.get(n[i]));else for(i in t)this.set(i,t[i])}function Qn(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var i=t.g[e];Xn(t.h,i)&&(t.g[n++]=i),e++}t.g.length=n}if(t.i!=t.g.length){var s={};for(n=e=0;e<t.g.length;)Xn(s,i=t.g[e])||(t.g[n++]=i,s[i]=1),e++;t.g.length=n}}function Xn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(_t=Dn.prototype).setTimeout=function(t){this.P=t},_t.gb=function(t){t=t.target;const e=this.L;e&&3==Qi(t)?e.l():this.Ia(t)},_t.Ia=function(t){try{if(t==this.g)t:{const h=Qi(this.g);var e=this.g.Da();const l=this.g.ba();if(!(3>h)&&(3!=h||ae||this.g&&(this.h.h||this.g.ga()||Xi(this.g)))){this.I||4!=h||7==e||mn(8==e||0>=l?3:2),$n(this);var n=this.g.ba();this.N=n;e:if(Un(this)){var i=Xi(this.g);t="";var s=i.length,r=4==Qi(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Kn(this),zn(this);var o="";break e}this.h.i=new Ct.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(t,e,n,i,s,r,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!zt(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,vn(12),Kn(this),zn(this);break t}ln(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Hn(this,n)}this.U?(Vn(this,h,o),ae&&this.i&&3==h&&(cn(this.V,this.W,"tick",this.fb),this.W.start())):(ln(this.j,this.m,o,null),Hn(this,o)),4==h&&Kn(this),this.i&&!this.I&&(4==h?fs(this.l,this):(this.i=!1,Bn(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,vn(12)):(this.o=0,vn(13)),Kn(this),zn(this)}}}catch(t){}},_t.fb=function(){if(this.g){var t=Qi(this.g),e=this.g.ga();this.C<e.length&&($n(this),Vn(this,t,e),this.i&&4!=t&&Bn(this))}},_t.cancel=function(){this.I=!0,Kn(this)},_t.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(mn(3),vn(17)),Kn(this),this.o=2,zn(this)):qn(this,this.Y-t)},(_t=Wn.prototype).R=function(){Qn(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},_t.T=function(){return Qn(this),this.g.concat()},_t.get=function(t,e){return Xn(this.h,t)?this.h[t]:e},_t.set=function(t,e){Xn(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},_t.forEach=function(t,e){for(var n=this.T(),i=0;i<n.length;i++){var s=n[i],r=this.get(s);t.call(e,r,s,this)}};var Jn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Yn(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Yn){this.g=void 0!==e?e:t.g,ti(this,t.j),this.s=t.s,ei(this,t.i),ni(this,t.m),this.l=t.l,e=t.h;var n=new pi;n.i=e.i,e.g&&(n.g=new Wn(e.g),n.h=e.h),ii(this,n),this.o=t.o}else t&&(n=String(t).match(Jn))?(this.g=!!e,ti(this,n[1]||"",!0),this.s=oi(n[2]||""),ei(this,n[3]||"",!0),ni(this,n[4]),this.l=oi(n[5]||"",!0),ii(this,n[6]||"",!0),this.o=oi(n[7]||"")):(this.g=!!e,this.h=new pi(null,this.g))}function Zn(t){return new Yn(t)}function ti(t,e,n){t.j=n?oi(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ei(t,e,n){t.i=n?oi(e,!0):e}function ni(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function ii(t,e,n){e instanceof pi?(t.h=e,function(t,e){e&&!t.j&&(gi(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(mi(this,e),vi(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=ai(e,di)),t.h=new pi(e,t.g))}function si(t,e,n){t.h.set(e,n)}function ri(t){return si(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function oi(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function ai(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ci),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ci(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Yn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(ai(e,ui,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(ai(e,ui,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(ai(n,"/"==n.charAt(0)?li:hi,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",ai(n,fi)),t.join("")};var ui=/[#\/\?@]/g,hi=/[#\?:]/g,li=/[#\?]/g,di=/[#\?@]/g,fi=/#/g;function pi(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function gi(t){t.g||(t.g=new Wn,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),s=null;if(0<=i){var r=t[n].substring(0,i);s=t[n].substring(i+1)}else r=t[n];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function mi(t,e){gi(t),e=wi(t,e),Xn(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Xn((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Qn(t)))}function yi(t,e){return gi(t),e=wi(t,e),Xn(t.g.h,e)}function vi(t,e,n){mi(t,e),0<n.length&&(t.i=null,t.g.set(wi(t,e),$t(n)),t.h+=n.length)}function wi(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ii(t){this.l=t||bi,t=Ct.PerformanceNavigationTiming?0<(t=Ct.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Ct.g&&Ct.g.Ea&&Ct.g.Ea()&&Ct.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(_t=pi.prototype).add=function(t,e){gi(this),this.i=null,t=wi(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},_t.forEach=function(t,e){gi(this),this.g.forEach((function(n,i){Bt(n,(function(n){t.call(e,n,i,this)}),this)}),this)},_t.T=function(){gi(this);for(var t=this.g.R(),e=this.g.T(),n=[],i=0;i<e.length;i++)for(var s=t[i],r=0;r<s.length;r++)n.push(e[i]);return n},_t.R=function(t){gi(this);var e=[];if("string"==typeof t)yi(this,t)&&(e=qt(e,this.g.get(wi(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=qt(e,t[n])}return e},_t.set=function(t,e){return gi(this),this.i=null,yi(this,t=wi(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},_t.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},_t.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var i=e[n],s=encodeURIComponent(String(i));i=this.R(i);for(var r=0;r<i.length;r++){var o=s;""!==i[r]&&(o+="="+encodeURIComponent(String(i[r]))),t.push(o)}}return this.i=t.join("&")};var bi=10;function Ti(t){return!!t.h||!!t.g&&t.g.size>=t.j}function _i(t){return t.h?1:t.g?t.g.size:0}function Ei(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Si(t,e){t.g?t.g.add(e):t.h=e}function ki(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Ci(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return $t(t.i)}function Ai(){}function Ni(){this.g=new Ai}function Ri(t,e,n){const i=n||"";try{Gn(t,(function(t,n){let s=t;Rt(t)&&(s=ze(t)),e.push(i+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function Di(t,e,n,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch(t){}}function Oi(t){this.l=t.$b||null,this.j=t.ib||!1}function Pi(t,e){Be.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Li,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ii.prototype.cancel=function(){if(this.i=Ci(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},Ai.prototype.stringify=function(t){return Ct.JSON.stringify(t,void 0)},Ai.prototype.parse=function(t){return Ct.JSON.parse(t,void 0)},Ft(Oi,_n),Oi.prototype.g=function(){return new Pi(this.l,this.j)},Oi.prototype.i=function(t){return function(){return t}}({}),Ft(Pi,Be);var Li=0;function Mi(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function xi(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Fi(t)}function Fi(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(_t=Pi.prototype).open=function(t,e){if(this.readyState!=Li)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Fi(this)},_t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||Ct).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},_t.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,xi(this)),this.readyState=Li},_t.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Fi(this)),this.g&&(this.readyState=3,Fi(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==Ct.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Mi(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},_t.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?xi(this):Fi(this),3==this.readyState&&Mi(this)}},_t.Ua=function(t){this.g&&(this.response=this.responseText=t,xi(this))},_t.Ta=function(t){this.g&&(this.response=t,xi(this))},_t.ha=function(){this.g&&xi(this)},_t.setRequestHeader=function(t,e){this.v.append(t,e)},_t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},_t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Pi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Ui=Ct.JSON.parse;function Vi(t){Be.call(this),this.headers=new Wn,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=ji,this.K=this.L=!1}Ft(Vi,Be);var ji="",Bi=/^https?$/i,qi=["POST","PUT"];function $i(t){return"content-type"==t.toLowerCase()}function zi(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Ki(t),Gi(t)}function Ki(t){t.D||(t.D=!0,qe(t,"complete"),qe(t,"error"))}function Hi(t){if(t.h&&void 0!==kt&&(!t.C[1]||4!=Qi(t)||2!=t.ba()))if(t.v&&4==Qi(t))nn(t.Fa,0,t);else if(qe(t,"readystatechange"),4==Qi(t)){t.h=!1;try{const a=t.ba();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===a){var s=String(t.H).match(Jn)[1]||null;if(!s&&Ct.self&&Ct.self.location){var r=Ct.self.location.protocol;s=r.substr(0,r.length-1)}i=!Bi.test(s?s.toLowerCase():"")}n=i}if(n)qe(t,"complete"),qe(t,"success");else{t.m=6;try{var o=2<Qi(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.ba()+"]",Ki(t)}}finally{Gi(t)}}}function Gi(t,e){if(t.g){Wi(t);const n=t.g,i=t.C[0]?At:null;t.g=null,t.C=null,e||qe(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function Wi(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(Ct.clearTimeout(t.A),t.A=null)}function Qi(t){return t.g?t.g.readyState:0}function Xi(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case ji:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ji(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=function(t){let e="";return Jt(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):si(t,e,n))}function Yi(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Zi(t){this.za=0,this.l=[],this.h=new hn,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Yi("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Yi("baseRetryDelayMs",5e3,t),this.$a=Yi("retryDelaySeedMs",1e4,t),this.Ya=Yi("forwardChannelMaxRetries",2,t),this.ra=Yi("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Ii(t&&t.concurrentRequestLimit),this.Ca=new Ni,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function ts(t){if(ns(t),3==t.G){var e=t.V++,n=Zn(t.F);si(n,"SID",t.J),si(n,"RID",e),si(n,"TYPE","terminate"),os(t,n),(e=new Dn(t,t.h,e,void 0)).K=2,e.v=ri(Zn(n)),n=!1,Ct.navigator&&Ct.navigator.sendBeacon&&(n=Ct.navigator.sendBeacon(e.v.toString(),"")),!n&&Ct.Image&&((new Image).src=e.v,n=!0),n||(e.g=vs(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Bn(e)}ms(t)}function es(t){t.g&&(hs(t),t.g.cancel(),t.g=null)}function ns(t){es(t),t.u&&(Ct.clearTimeout(t.u),t.u=null),ds(t),t.i.cancel(),t.m&&("number"==typeof t.m&&Ct.clearTimeout(t.m),t.m=null)}function is(t,e){t.l.push(new class{constructor(t,e){this.h=t,this.g=e}}(t.Za++,e)),3==t.G&&ss(t)}function ss(t){Ti(t.i)||t.m||(t.m=!0,Xe(t.Ha,t),t.C=0)}function rs(t,e){var n;n=e?e.m:t.V++;const i=Zn(t.F);si(i,"SID",t.J),si(i,"RID",n),si(i,"AID",t.U),os(t,i),t.o&&t.s&&Ji(i,t.o,t.s),n=new Dn(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=as(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Si(t.i,n),xn(n,i,e)}function os(t,e){t.j&&Gn({},(function(t,n){si(e,n,t)}))}function as(t,e,n){n=Math.min(t.l.length,n);var i=t.j?Mt(t.j.Oa,t.j,t):null;t:{var s=t.l;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let r=!0;for(let o=0;o<n;o++){let n=s[o].h;const a=s[o].g;if(n-=e,0>n)e=Math.max(0,s[o].h-100),r=!1;else try{Ri(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(r){i=t.join("&");break t}}}return t=t.l.splice(0,n),e.D=t,i}function cs(t){t.g||t.u||(t.Y=1,Xe(t.Ga,t),t.A=0)}function us(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=In(Mt(t.Ga,t),ps(t,t.A)),t.A++,0))}function hs(t){null!=t.B&&(Ct.clearTimeout(t.B),t.B=null)}function ls(t){t.g=new Dn(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Zn(t.oa);si(e,"RID","rpc"),si(e,"SID",t.J),si(e,"CI",t.N?"0":"1"),si(e,"AID",t.U),os(t,e),si(e,"TYPE","xmlhttp"),t.o&&t.s&&Ji(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=ri(Zn(e)),n.s=null,n.U=!0,Fn(n,t)}function ds(t){null!=t.v&&(Ct.clearTimeout(t.v),t.v=null)}function fs(t,e){var n=null;if(t.g==e){ds(t),hs(t),t.g=null;var i=2}else{if(!Ei(t.i,e))return;n=e.D,ki(t.i,e),i=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.F;var s=t.C;qe(i=pn(),new wn(i,n,e,s)),ss(t)}else cs(t);else if(3==(s=e.o)||0==s&&0<t.I||!(1==i&&function(t,e){return!(_i(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=In(Mt(t.Ha,t,e),ps(t,t.C)),t.C++,0)))}(t,e)||2==i&&us(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:gs(t,5);break;case 4:gs(t,10);break;case 3:gs(t,6);break;default:gs(t,2)}}function ps(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function gs(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var i=Mt(t.jb,t);n||(n=new Yn("//www.google.com/images/cleardot.gif"),Ct.location&&"http"==Ct.location.protocol||ti(n,"https"),ri(n)),function(t,e){const n=new hn;if(Ct.Image){const i=new Image;i.onload=xt(Di,n,i,"TestLoadImage: loaded",!0,e),i.onerror=xt(Di,n,i,"TestLoadImage: error",!1,e),i.onabort=xt(Di,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=xt(Di,n,i,"TestLoadImage: timeout",!1,e),Ct.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else vn(2);t.G=0,t.j&&t.j.va(e),ms(t),ns(t)}function ms(t){t.G=0,t.I=-1,t.j&&(0==Ci(t.i).length&&0==t.l.length||(t.i.i.length=0,$t(t.l),t.l.length=0),t.j.ua())}function ys(t,e,n){let i=function(t){return t instanceof Yn?Zn(t):new Yn(t,void 0)}(n);if(""!=i.i)e&&ei(i,e+"."+i.i),ni(i,i.m);else{const t=Ct.location;i=function(t,e,n,i){var s=new Yn(null,void 0);return t&&ti(s,t),e&&ei(s,e),n&&ni(s,n),i&&(s.l=i),s}(t.protocol,e?e+"."+t.hostname:t.hostname,+t.port,n)}return t.aa&&Jt(t.aa,(function(t,e){si(i,e,t)})),e=t.D,n=t.sa,e&&n&&si(i,e,n),si(i,"VER",t.ma),os(t,i),i}function vs(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new Vi(new Oi({ib:!0})):new Vi(t.qa)).L=t.H,e}function ws(){}function Is(){if(re&&!(10<=Number(ye)))throw Error("Environmental error: no available transport.")}function bs(t,e){Be.call(this),this.g=new Zi(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!zt(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!zt(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Es(this)}function Ts(t){An.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function _s(){Nn.call(this),this.status=1}function Es(t){this.g=t}(_t=Vi.prototype).ea=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():kn.g(),this.C=this.u?En(this.u):En(kn),this.g.onreadystatechange=Mt(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void zi(this,t)}t=n||"";const s=new Wn(this.headers);i&&Gn(i,(function(t,e){s.set(e,t)})),i=function(t){t:{var e=$i;const n=t.length,i="string"==typeof t?t.split(""):t;for(let s=0;s<n;s++)if(s in i&&e.call(void 0,i[s],s,t)){e=s;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(s.T()),n=Ct.FormData&&t instanceof Ct.FormData,!(0<=jt(qi,e))||i||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Wi(this),0<this.B&&((this.K=function(t){return re&&me()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Mt(this.pa,this)):this.A=nn(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){zi(this,t)}},_t.pa=function(){void 0!==kt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,qe(this,"timeout"),this.abort(8))},_t.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,qe(this,"complete"),qe(this,"abort"),Gi(this))},_t.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Gi(this,!0)),Vi.Z.M.call(this)},_t.Fa=function(){this.s||(this.F||this.v||this.l?Hi(this):this.cb())},_t.cb=function(){Hi(this)},_t.ba=function(){try{return 2<Qi(this)?this.g.status:-1}catch(t){return-1}},_t.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},_t.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Ui(e)}},_t.Da=function(){return this.m},_t.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(_t=Zi.prototype).ma=8,_t.G=1,_t.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},_t.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new Dn(this,this.h,t,void 0);let r=this.s;if(this.P&&(r?(r=Yt(r),te(r,this.P)):r=this.P),null===this.o&&(s.H=r),this.ja)t:{for(var e=0,n=0;n<this.l.length;n++){var i=this.l[n];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.l.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=as(this,s,e),si(n=Zn(this.F),"RID",t),si(n,"CVER",22),this.D&&si(n,"X-HTTP-Session-Id",this.D),os(this,n),this.o&&r&&Ji(n,this.o,r),Si(this.i,s),this.Ra&&si(n,"TYPE","init"),this.ja?(si(n,"$req",e),si(n,"SID","null"),s.$=!0,xn(s,n,null)):xn(s,n,e),this.G=2}}else 3==this.G&&(t?rs(this,t):0==this.l.length||Ti(this.i)||rs(this))},_t.Ga=function(){if(this.u=null,ls(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=In(Mt(this.bb,this),t)}},_t.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,vn(10),es(this),ls(this))},_t.ab=function(){null!=this.v&&(this.v=null,es(this),us(this),vn(19))},_t.jb=function(t){t?(this.h.info("Successfully pinged google.com"),vn(2)):(this.h.info("Failed to ping google.com"),vn(1))},(_t=ws.prototype).xa=function(){},_t.wa=function(){},_t.va=function(){},_t.ua=function(){},_t.Oa=function(){},Is.prototype.g=function(t,e){return new bs(t,e)},Ft(bs,Be),bs.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Xe(Mt(t.hb,t,e))),vn(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=ys(t,null,t.W),ss(t)},bs.prototype.close=function(){ts(this.g)},bs.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,is(this.g,e)}else this.v?((e={}).__data__=ze(t),is(this.g,e)):is(this.g,t)},bs.prototype.M=function(){this.g.j=null,delete this.j,ts(this.g),delete this.g,bs.Z.M.call(this)},Ft(Ts,An),Ft(_s,Nn),Ft(Es,ws),Es.prototype.xa=function(){qe(this.g,"a")},Es.prototype.wa=function(t){qe(this.g,new Ts(t))},Es.prototype.va=function(t){qe(this.g,new _s(t))},Es.prototype.ua=function(){qe(this.g,"b")},Is.prototype.createWebChannel=Is.prototype.g,bs.prototype.send=bs.prototype.u,bs.prototype.open=bs.prototype.m,bs.prototype.close=bs.prototype.close,bn.NO_ERROR=0,bn.TIMEOUT=8,bn.HTTP_ERROR=6,Tn.COMPLETE="complete",Sn.EventType=Cn,Cn.OPEN="a",Cn.CLOSE="b",Cn.ERROR="c",Cn.MESSAGE="d",Be.prototype.listen=Be.prototype.N,Vi.prototype.listenOnce=Vi.prototype.O,Vi.prototype.getLastError=Vi.prototype.La,Vi.prototype.getLastErrorCode=Vi.prototype.Da,Vi.prototype.getStatus=Vi.prototype.ba,Vi.prototype.getResponseJson=Vi.prototype.Qa,Vi.prototype.getResponseText=Vi.prototype.ga,Vi.prototype.send=Vi.prototype.ea;var Ss=St.createWebChannelTransport=function(){return new Is},ks=St.getStatEventTarget=function(){return pn()},Cs=St.ErrorCode=bn,As=St.EventType=Tn,Ns=St.Event=dn,Rs=St.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Ds=St.FetchXmlHttpFactory=Oi,Os=St.WebChannel=Sn,Ps=St.XhrIo=Vi;const Ls="@firebase/firestore";class Ms{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ms.UNAUTHENTICATED=new Ms(null),Ms.GOOGLE_CREDENTIALS=new Ms("google-credentials-uid"),Ms.FIRST_PARTY=new Ms("first-party-uid"),Ms.MOCK_USER=new Ms("mock-user");let xs="9.9.0";const Fs=new M("@firebase/firestore");function Us(){return Fs.logLevel}function Vs(t,...e){if(Fs.logLevel<=N.DEBUG){const n=e.map(qs);Fs.debug(`Firestore (${xs}): ${t}`,...n)}}function js(t,...e){if(Fs.logLevel<=N.ERROR){const n=e.map(qs);Fs.error(`Firestore (${xs}): ${t}`,...n)}}function Bs(t,...e){if(Fs.logLevel<=N.WARN){const n=e.map(qs);Fs.warn(`Firestore (${xs}): ${t}`,...n)}}function qs(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function $s(t="Unexpected state"){const e=`FIRESTORE (${xs}) INTERNAL ASSERTION FAILED: `+t;throw js(e),new Error(e)}function zs(t,e){t||$s()}function Ks(t,e){return t}const Hs={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Gs extends d{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ws{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Qs{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Xs{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Ms.UNAUTHENTICATED)))}shutdown(){}}class Js{constructor(t){this.t=t,this.currentUser=Ms.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new Ws;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ws,t.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{Vs("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Vs("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ws)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Vs("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(zs("string"==typeof e.accessToken),new Qs(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return zs(null===t||"string"==typeof t),new Ms(t)}}class Ys{constructor(t,e,n){this.type="FirstParty",this.user=Ms.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class Zs{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new Ys(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(Ms.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class tr{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class er{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,e){const n=t=>{null!=t.error&&Vs("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.p;return this.p=t.token,Vs("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{Vs("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?i(t):Vs("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(zs("string"==typeof t.token),this.p=t.token,new tr(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function nr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}function ir(t,e){return t<e?-1:t>e?1:0}function sr(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}class rr{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Gs(Hs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Gs(Hs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Gs(Hs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Gs(Hs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return rr.fromMillis(Date.now())}static fromDate(t){return rr.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new rr(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?ir(this.nanoseconds,t.nanoseconds):ir(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class or{constructor(t){this.timestamp=t}static fromTimestamp(t){return new or(t)}static min(){return new or(new rr(0,0))}static max(){return new or(new rr(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ar{constructor(t,e,n){void 0===e?e=0:e>t.length&&$s(),void 0===n?n=t.length-e:n>t.length-e&&$s(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ar.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ar?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),s=e.get(i);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class cr extends ar{construct(t,e,n){return new cr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Gs(Hs.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new cr(e)}static emptyPath(){return new cr([])}}const ur=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class hr extends ar{construct(t,e,n){return new hr(t,e,n)}static isValidIdentifier(t){return ur.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),hr.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new hr(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const s=()=>{if(0===n.length)throw new Gs(Hs.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new Gs(Hs.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Gs(Hs.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(r=!r,i++):"."!==e||r?(n+=e,i++):(s(),i++)}if(s(),r)throw new Gs(Hs.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new hr(e)}static emptyPath(){return new hr([])}}class lr{constructor(t){this.path=t}static fromPath(t){return new lr(cr.fromString(t))}static fromName(t){return new lr(cr.fromString(t).popFirst(5))}static empty(){return new lr(cr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===cr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return cr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new lr(new cr(t.slice()))}}function dr(t){return new fr(t.readTime,t.key,-1)}class fr{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new fr(or.min(),lr.empty(),-1)}static max(){return new fr(or.max(),lr.empty(),-1)}}function pr(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=lr.comparator(t.documentKey,e.documentKey),0!==n?n:ir(t.largestBatchId,e.largestBatchId))}async function gr(t){if(t.code!==Hs.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;Vs("LocalStore","Unexpectedly lost primary lease")}class mr{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&$s(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new mr(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof mr?e:mr.resolve(e)}catch(t){return mr.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):mr.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):mr.reject(e)}static resolve(t){return new mr(((e,n)=>{e(t)}))}static reject(t){return new mr(((e,n)=>{n(t)}))}static waitFor(t){return new mr(((e,n)=>{let i=0,s=0,r=!1;t.forEach((t=>{++i,t.next((()=>{++s,r&&s===i&&e()}),(t=>n(t)))})),r=!0,s===i&&e()}))}static or(t){let e=mr.resolve(!1);for(const n of t)e=e.next((t=>t?mr.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}static mapArray(t,e){return new mr(((n,i)=>{const s=t.length,r=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{r[c]=t,++o,o===s&&n(r)}),(t=>i(t)))}}))}static doWhile(t,e){return new mr(((n,i)=>{const s=()=>{!0===t()?e().next((()=>{s()}),i):n()};s()}))}}function yr(t){return"IndexedDbTransactionError"===t.name}class vr{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.it(t),this.rt=t=>e.writeSequenceNumber(t))}it(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.rt&&this.rt(t),t}}function wr(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ir(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}vr.ot=-1;class br{constructor(t,e){this.comparator=t,this.root=e||_r.EMPTY}insert(t,e){return new br(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,_r.BLACK,null,null))}remove(t){return new br(this.comparator,this.root.remove(t,this.comparator).copy(null,null,_r.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Tr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Tr(this.root,t,this.comparator,!1)}getReverseIterator(){return new Tr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Tr(this.root,t,this.comparator,!0)}}class Tr{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class _r{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:_r.RED,this.left=null!=i?i:_r.EMPTY,this.right=null!=s?s:_r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new _r(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return _r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return _r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,_r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,_r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $s();if(this.right.isRed())throw $s();const t=this.left.check();if(t!==this.right.check())throw $s();return t+(this.isRed()?0:1)}}_r.EMPTY=null,_r.RED=!0,_r.BLACK=!1,_r.EMPTY=new class{constructor(){this.size=0}get key(){throw $s()}get value(){throw $s()}get color(){throw $s()}get left(){throw $s()}get right(){throw $s()}copy(t,e,n,i,s){return this}insert(t,e,n){return new _r(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Er{constructor(t){this.comparator=t,this.data=new br(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Sr(this.data.getIterator())}getIteratorFrom(t){return new Sr(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Er))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Er(this.comparator);return e.data=t,e}}class Sr{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class kr{constructor(t){this.fields=t,t.sort(hr.comparator)}static empty(){return new kr([])}unionWith(t){let e=new Er(hr.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new kr(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return sr(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Cr{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new Cr(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Cr(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ir(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Cr.EMPTY_BYTE_STRING=new Cr("");const Ar=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nr(t){if(zs(!!t),"string"==typeof t){let e=0;const n=Ar.exec(t);if(zs(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Rr(t.seconds),nanos:Rr(t.nanos)}}function Rr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Dr(t){return"string"==typeof t?Cr.fromBase64String(t):Cr.fromUint8Array(t)}function Or(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Pr(t){const e=t.mapValue.fields.__previous_value__;return Or(e)?Pr(e):e}function Lr(t){const e=Nr(t.mapValue.fields.__local_write_time__.timestampValue);return new rr(e.seconds,e.nanos)}class Mr{constructor(t,e,n,i,s,r,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class xr{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new xr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof xr&&t.projectId===this.projectId&&t.database===this.database}}function Fr(t){return null==t}function Ur(t){return 0===t&&1/t==-1/0}const Vr={fields:{__type__:{stringValue:"__max__"}}};function jr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Or(t)?4:Zr(t)?9007199254740991:10:$s()}function Br(t,e){if(t===e)return!0;const n=jr(t);if(n!==jr(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Lr(t).isEqual(Lr(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Nr(t.timestampValue),i=Nr(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Dr(t.bytesValue).isEqual(Dr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Rr(t.geoPointValue.latitude)===Rr(e.geoPointValue.latitude)&&Rr(t.geoPointValue.longitude)===Rr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Rr(t.integerValue)===Rr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Rr(t.doubleValue),i=Rr(e.doubleValue);return n===i?Ur(n)===Ur(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return sr(t.arrayValue.values||[],e.arrayValue.values||[],Br);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(wr(n)!==wr(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!Br(n[t],i[t])))return!1;return!0}(t,e);default:return $s()}}function qr(t,e){return void 0!==(t.values||[]).find((t=>Br(t,e)))}function $r(t,e){if(t===e)return 0;const n=jr(t),i=jr(e);if(n!==i)return ir(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return ir(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Rr(t.integerValue||t.doubleValue),i=Rr(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return zr(t.timestampValue,e.timestampValue);case 4:return zr(Lr(t),Lr(e));case 5:return ir(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Dr(t),i=Dr(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=ir(n[t],i[t]);if(0!==e)return e}return ir(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ir(Rr(t.latitude),Rr(e.latitude));return 0!==n?n:ir(Rr(t.longitude),Rr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=$r(n[t],i[t]);if(e)return e}return ir(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Vr&&e===Vr)return 0;if(t===Vr)return 1;if(e===Vr)return-1;const n=t.fields||{},i=Object.keys(n),s=e.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let t=0;t<i.length&&t<r.length;++t){const e=ir(i[t],r[t]);if(0!==e)return e;const o=$r(n[i[t]],s[r[t]]);if(0!==o)return o}return ir(i.length,r.length)}(t.mapValue,e.mapValue);default:throw $s()}}function zr(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ir(t,e);const n=Nr(t),i=Nr(e),s=ir(n.seconds,i.seconds);return 0!==s?s:ir(n.nanos,i.nanos)}function Kr(t){return Hr(t)}function Hr(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Nr(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?Dr(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,lr.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=Hr(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const s of e)i?i=!1:n+=",",n+=`${s}:${Hr(t.fields[s])}`;return n+"}"}(t.mapValue):$s();var e,n}function Gr(t){return!!t&&"integerValue"in t}function Wr(t){return!!t&&"arrayValue"in t}function Qr(t){return!!t&&"nullValue"in t}function Xr(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Jr(t){return!!t&&"mapValue"in t}function Yr(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ir(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Yr(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Yr(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Zr(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class to{constructor(t){this.value=t}static empty(){return new to({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Jr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Yr(e)}setAll(t){let e=hr.emptyPath(),n={},i=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=s.popLast()}t?n[s.lastSegment()]=Yr(t):i.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){const e=this.field(t.popLast());Jr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Br(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];Jr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Ir(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new to(Yr(this.value))}}class eo{constructor(t,e,n,i,s,r){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.data=s,this.documentState=r}static newInvalidDocument(t){return new eo(t,0,or.min(),or.min(),to.empty(),0)}static newFoundDocument(t,e,n){return new eo(t,1,e,or.min(),n,0)}static newNoDocument(t,e){return new eo(t,2,e,or.min(),to.empty(),0)}static newUnknownDocument(t,e){return new eo(t,3,e,or.min(),to.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=to.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=to.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=or.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof eo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new eo(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class no{constructor(t,e=null,n=[],i=[],s=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.ut=null}}function io(t,e=null,n=[],i=[],s=null,r=null,o=null){return new no(t,e,n,i,s,r,o)}function so(t){const e=Ks(t);if(null===e.ut){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+Kr(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Fr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Kr(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Kr(t))).join(",")),e.ut=t}return e.ut}function ro(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!wo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],i=e.filters[s],n.op!==i.op||!n.field.isEqual(i.field)||!Br(n.value,i.value))return!1;var n,i;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!bo(t.startAt,e.startAt)&&bo(t.endAt,e.endAt)}function oo(t){return lr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class ao extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.ct(t,e,n):new co(t,e,n):"array-contains"===e?new fo(t,n):"in"===e?new po(t,n):"not-in"===e?new go(t,n):"array-contains-any"===e?new mo(t,n):new ao(t,e,n)}static ct(t,e,n){return"in"===e?new uo(t,n):new ho(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.at($r(e,this.value)):null!==e&&jr(this.value)===jr(e)&&this.at($r(e,this.value))}at(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return $s()}}ht(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class co extends ao{constructor(t,e,n){super(t,e,n),this.key=lr.fromName(n.referenceValue)}matches(t){const e=lr.comparator(t.key,this.key);return this.at(e)}}class uo extends ao{constructor(t,e){super(t,"in",e),this.keys=lo(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class ho extends ao{constructor(t,e){super(t,"not-in",e),this.keys=lo(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function lo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>lr.fromName(t.referenceValue)))}class fo extends ao{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Wr(e)&&qr(e.arrayValue,this.value)}}class po extends ao{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&qr(this.value.arrayValue,e)}}class go extends ao{constructor(t,e){super(t,"not-in",e)}matches(t){if(qr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!qr(this.value.arrayValue,e)}}class mo extends ao{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Wr(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>qr(this.value.arrayValue,t)))}}class yo{constructor(t,e){this.position=t,this.inclusive=e}}class vo{constructor(t,e="asc"){this.field=t,this.dir=e}}function wo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Io(t,e,n){let i=0;for(let s=0;s<t.position.length;s++){const r=e[s],o=t.position[s];if(i=r.field.isKeyField()?lr.comparator(lr.fromName(o.referenceValue),n.key):$r(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function bo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Br(t.position[n],e.position[n]))return!1;return!0}class To{constructor(t,e=null,n=[],i=[],s=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.lt=null,this.ft=null,this.startAt,this.endAt}}function _o(t){return new To(t)}function Eo(t){const e=Ks(t);if(null===e.lt){e.lt=[];const t=function(t){for(const e of t.filters)if(e.ht())return e.field;return null}(e),n=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e.lt.push(new vo(t)),e.lt.push(new vo(hr.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.lt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.lt.push(new vo(hr.keyField(),t))}}}return e.lt}function So(t){const e=Ks(t);if(!e.ft)if("F"===e.limitType)e.ft=io(e.path,e.collectionGroup,Eo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Eo(e)){const e="desc"===n.dir?"asc":"desc";t.push(new vo(n.field,e))}const n=e.endAt?new yo(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new yo(e.startAt.position,e.startAt.inclusive):null;e.ft=io(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e.ft}function ko(t,e){return ro(So(t),So(e))&&t.limitType===e.limitType}function Co(t){return`${so(So(t))}|lt:${t.limitType}`}function Ao(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Kr(e.value)}`;var e})).join(", ")}]`),Fr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Kr(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Kr(t))).join(",")),`Target(${e})`}(So(t))}; limitType=${t.limitType})`}function No(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):lr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=Io(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,Eo(t),e)||t.endAt&&!function(t,e,n){const i=Io(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,Eo(t),e))}(t,e)}function Ro(t){return(e,n)=>{let i=!1;for(const s of Eo(t)){const t=Do(s,e,n);if(0!==t)return t;i=i||s.field.isKeyField()}return 0}}function Do(t,e,n){const i=t.field.isKeyField()?lr.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),s=n.data.field(t);return null!==i&&null!==s?$r(i,s):$s()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return $s()}}class Oo{constructor(){this._=void 0}}function Po(t,e,n){return t instanceof Mo?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof xo?Fo(t,e):t instanceof Uo?Vo(t,e):function(t,e){const n=function(t,e){return t instanceof jo?Gr(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}(t,e),i=Bo(n)+Bo(t._t);return Gr(n)&&Gr(t._t)?function(t){return{integerValue:""+t}}(i):function(t,e){if(t.dt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ur(e)?"-0":e}}(t.wt,i)}(t,e)}function Lo(t,e,n){return t instanceof xo?Fo(t,e):t instanceof Uo?Vo(t,e):n}class Mo extends Oo{}class xo extends Oo{constructor(t){super(),this.elements=t}}function Fo(t,e){const n=qo(e);for(const e of t.elements)n.some((t=>Br(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Uo extends Oo{constructor(t){super(),this.elements=t}}function Vo(t,e){let n=qo(e);for(const e of t.elements)n=n.filter((t=>!Br(t,e)));return{arrayValue:{values:n}}}class jo extends Oo{constructor(t,e){super(),this.wt=t,this._t=e}}function Bo(t){return Rr(t.integerValue||t.doubleValue)}function qo(t){return Wr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class $o{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new $o}static exists(t){return new $o(void 0,t)}static updateTime(t){return new $o(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function zo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ko{}function Ho(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new ea(t.key,$o.none()):new Xo(t.key,t.data,$o.none());{const n=t.data,i=to.empty();let s=new Er(hr.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),s=s.add(t)}return new Jo(t.key,i,new kr(s.toArray()),$o.none())}}function Go(t,e,n){t instanceof Xo?function(t,e,n){const i=t.value.clone(),s=Zo(t.fieldTransforms,e,n.transformResults);i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof Jo?function(t,e,n){if(!zo(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=Zo(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Yo(t)),s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Wo(t,e,n,i){return t instanceof Xo?function(t,e,n,i){if(!zo(t.precondition,e))return n;const s=t.value.clone(),r=ta(t.fieldTransforms,i,e);return s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,i):t instanceof Jo?function(t,e,n,i){if(!zo(t.precondition,e))return n;const s=ta(t.fieldTransforms,i,e),r=e.data;return r.setAll(Yo(t)),r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,i):function(t,e,n){return zo(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Qo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&sr(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof xo&&e instanceof xo||t instanceof Uo&&e instanceof Uo?sr(t.elements,e.elements,Br):t instanceof jo&&e instanceof jo?Br(t._t,e._t):t instanceof Mo&&e instanceof Mo}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Xo extends Ko{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Jo extends Ko{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Yo(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function Zo(t,e,n){const i=new Map;zs(t.length===n.length);for(let s=0;s<n.length;s++){const r=t[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,Lo(o,a,n[s]))}return i}function ta(t,e,n){const i=new Map;for(const s of t){const t=s.transform,r=n.data.field(s.field);i.set(s.field,Po(t,r,e))}return i}class ea extends Ko{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class na{constructor(t){this.count=t}}var ia,sa;function ra(t){if(void 0===t)return js("GRPC error has no .code"),Hs.UNKNOWN;switch(t){case ia.OK:return Hs.OK;case ia.CANCELLED:return Hs.CANCELLED;case ia.UNKNOWN:return Hs.UNKNOWN;case ia.DEADLINE_EXCEEDED:return Hs.DEADLINE_EXCEEDED;case ia.RESOURCE_EXHAUSTED:return Hs.RESOURCE_EXHAUSTED;case ia.INTERNAL:return Hs.INTERNAL;case ia.UNAVAILABLE:return Hs.UNAVAILABLE;case ia.UNAUTHENTICATED:return Hs.UNAUTHENTICATED;case ia.INVALID_ARGUMENT:return Hs.INVALID_ARGUMENT;case ia.NOT_FOUND:return Hs.NOT_FOUND;case ia.ALREADY_EXISTS:return Hs.ALREADY_EXISTS;case ia.PERMISSION_DENIED:return Hs.PERMISSION_DENIED;case ia.FAILED_PRECONDITION:return Hs.FAILED_PRECONDITION;case ia.ABORTED:return Hs.ABORTED;case ia.OUT_OF_RANGE:return Hs.OUT_OF_RANGE;case ia.UNIMPLEMENTED:return Hs.UNIMPLEMENTED;case ia.DATA_LOSS:return Hs.DATA_LOSS;default:return $s()}}(sa=ia||(ia={}))[sa.OK=0]="OK",sa[sa.CANCELLED=1]="CANCELLED",sa[sa.UNKNOWN=2]="UNKNOWN",sa[sa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",sa[sa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",sa[sa.NOT_FOUND=5]="NOT_FOUND",sa[sa.ALREADY_EXISTS=6]="ALREADY_EXISTS",sa[sa.PERMISSION_DENIED=7]="PERMISSION_DENIED",sa[sa.UNAUTHENTICATED=16]="UNAUTHENTICATED",sa[sa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",sa[sa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",sa[sa.ABORTED=10]="ABORTED",sa[sa.OUT_OF_RANGE=11]="OUT_OF_RANGE",sa[sa.UNIMPLEMENTED=12]="UNIMPLEMENTED",sa[sa.INTERNAL=13]="INTERNAL",sa[sa.UNAVAILABLE=14]="UNAVAILABLE",sa[sa.DATA_LOSS=15]="DATA_LOSS";class oa{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Ir(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}size(){return this.innerSize}}const aa=new br(lr.comparator);function ca(){return aa}const ua=new br(lr.comparator);function ha(...t){let e=ua;for(const n of t)e=e.insert(n.key,n);return e}function la(t){let e=ua;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function da(){return pa()}function fa(){return pa()}function pa(){return new oa((t=>t.toString()),((t,e)=>t.isEqual(e)))}new br(lr.comparator);const ga=new Er(lr.comparator);function ma(...t){let e=ga;for(const n of t)e=e.add(n);return e}const ya=new Er(ir);function va(){return ya}class wa{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,Ia.createSynthesizedTargetChangeForCurrentChange(t,e)),new wa(or.min(),n,va(),ca(),ma())}}class Ia{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e){return new Ia(Cr.EMPTY_BYTE_STRING,e,ma(),ma(),ma())}}class ba{constructor(t,e,n,i){this.gt=t,this.removedTargetIds=e,this.key=n,this.yt=i}}class Ta{constructor(t,e){this.targetId=t,this.It=e}}class _a{constructor(t,e,n=Cr.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class Ea{constructor(){this.Tt=0,this.Et=Ca(),this.At=Cr.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return 0!==this.Tt}get vt(){return this.bt}Vt(t){t.approximateByteSize()>0&&(this.bt=!0,this.At=t)}St(){let t=ma(),e=ma(),n=ma();return this.Et.forEach(((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:$s()}})),new Ia(this.At,this.Rt,t,e,n)}Dt(){this.bt=!1,this.Et=Ca()}Ct(t,e){this.bt=!0,this.Et=this.Et.insert(t,e)}xt(t){this.bt=!0,this.Et=this.Et.remove(t)}Nt(){this.Tt+=1}kt(){this.Tt-=1}Ot(){this.bt=!0,this.Rt=!0}}class Sa{constructor(t){this.Mt=t,this.Ft=new Map,this.$t=ca(),this.Bt=ka(),this.Lt=new Er(ir)}Ut(t){for(const e of t.gt)t.yt&&t.yt.isFoundDocument()?this.qt(e,t.yt):this.Kt(e,t.key,t.yt);for(const e of t.removedTargetIds)this.Kt(e,t.key,t.yt)}Gt(t){this.forEachTarget(t,(e=>{const n=this.Qt(e);switch(t.state){case 0:this.jt(e)&&n.Vt(t.resumeToken);break;case 1:n.kt(),n.Pt||n.Dt(),n.Vt(t.resumeToken);break;case 2:n.kt(),n.Pt||this.removeTarget(e);break;case 3:this.jt(e)&&(n.Ot(),n.Vt(t.resumeToken));break;case 4:this.jt(e)&&(this.Wt(e),n.Vt(t.resumeToken));break;default:$s()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ft.forEach(((t,n)=>{this.jt(n)&&e(n)}))}zt(t){const e=t.targetId,n=t.It.count,i=this.Ht(e);if(i){const t=i.target;if(oo(t))if(0===n){const n=new lr(t.path);this.Kt(e,n,eo.newNoDocument(n,or.min()))}else zs(1===n);else this.Jt(e)!==n&&(this.Wt(e),this.Lt=this.Lt.add(e))}}Yt(t){const e=new Map;this.Ft.forEach(((n,i)=>{const s=this.Ht(i);if(s){if(n.current&&oo(s.target)){const e=new lr(s.target.path);null!==this.$t.get(e)||this.Xt(i,e)||this.Kt(i,e,eo.newNoDocument(e,t))}n.vt&&(e.set(i,n.St()),n.Dt())}}));let n=ma();this.Bt.forEach(((t,e)=>{let i=!0;e.forEachWhile((t=>{const e=this.Ht(t);return!e||2===e.purpose||(i=!1,!1)})),i&&(n=n.add(t))})),this.$t.forEach(((e,n)=>n.setReadTime(t)));const i=new wa(t,e,this.Lt,this.$t,n);return this.$t=ca(),this.Bt=ka(),this.Lt=new Er(ir),i}qt(t,e){if(!this.jt(t))return;const n=this.Xt(t,e.key)?2:0;this.Qt(t).Ct(e.key,n),this.$t=this.$t.insert(e.key,e),this.Bt=this.Bt.insert(e.key,this.Zt(e.key).add(t))}Kt(t,e,n){if(!this.jt(t))return;const i=this.Qt(t);this.Xt(t,e)?i.Ct(e,1):i.xt(e),this.Bt=this.Bt.insert(e,this.Zt(e).delete(t)),n&&(this.$t=this.$t.insert(e,n))}removeTarget(t){this.Ft.delete(t)}Jt(t){const e=this.Qt(t).St();return this.Mt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Nt(t){this.Qt(t).Nt()}Qt(t){let e=this.Ft.get(t);return e||(e=new Ea,this.Ft.set(t,e)),e}Zt(t){let e=this.Bt.get(t);return e||(e=new Er(ir),this.Bt=this.Bt.insert(t,e)),e}jt(t){const e=null!==this.Ht(t);return e||Vs("WatchChangeAggregator","Detected inactive target",t),e}Ht(t){const e=this.Ft.get(t);return e&&e.Pt?null:this.Mt.te(t)}Wt(t){this.Ft.set(t,new Ea),this.Mt.getRemoteKeysForTarget(t).forEach((e=>{this.Kt(t,e,null)}))}Xt(t,e){return this.Mt.getRemoteKeysForTarget(t).has(e)}}function ka(){return new br(lr.comparator)}function Ca(){return new br(lr.comparator)}const Aa={asc:"ASCENDING",desc:"DESCENDING"},Na={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Ra{constructor(t,e){this.databaseId=t,this.dt=e}}function Da(t){return zs(!!t),or.fromTimestamp(function(t){const e=Nr(t);return new rr(e.seconds,e.nanos)}(t))}function Oa(t){const e=cr.fromString(t);return zs(Ga(e)),e}function Pa(t,e){const n=Oa(e);if(n.get(1)!==t.databaseId.projectId)throw new Gs(Hs.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Gs(Hs.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new lr(xa(n))}function La(t,e){return function(t,e){return function(t){return new cr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}(t.databaseId,e)}function Ma(t){return new cr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function xa(t){return zs(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Fa(t,e){return{documents:[La(t,e.path)]}}function Ua(t,e){const n={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(n.parent=La(t,i),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=La(t,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Xr(t.value))return{unaryFilter:{field:$a(t.field),op:"IS_NAN"}};if(Qr(t.value))return{unaryFilter:{field:$a(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Xr(t.value))return{unaryFilter:{field:$a(t.field),op:"IS_NOT_NAN"}};if(Qr(t.value))return{unaryFilter:{field:$a(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$a(t.field),op:qa(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:$a(t.field),direction:Ba(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.dt||Fr(e)?e:{value:e}}(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Va(t){let e=function(t){const e=Oa(t);return 4===e.length?cr.emptyPath():xa(e)}(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){zs(1===i);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=ja(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new vo(za(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Fr(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new yo(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new yo(n,e)}(n.endAt)),function(t,e,n,i,s,r,o,a){return new To(t,e,n,i,s,r,o,a)}(e,s,o,r,a,"F",c,u)}function ja(t){return t?void 0!==t.unaryFilter?[Ha(t)]:void 0!==t.fieldFilter?[Ka(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>ja(t))).reduce(((t,e)=>t.concat(e))):$s():[]}function Ba(t){return Aa[t]}function qa(t){return Na[t]}function $a(t){return{fieldPath:t.canonicalString()}}function za(t){return hr.fromServerFormat(t.fieldPath)}function Ka(t){return ao.create(za(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return $s()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ha(t){switch(t.unaryFilter.op){case"IS_NAN":const e=za(t.unaryFilter.field);return ao.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=za(t.unaryFilter.field);return ao.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=za(t.unaryFilter.field);return ao.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=za(t.unaryFilter.field);return ao.create(s,"!=",{nullValue:"NULL_VALUE"});default:return $s()}}function Ga(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Wa{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&Go(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Wo(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Wo(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=fa();return this.mutations.forEach((i=>{const s=t.get(i.key),r=s.overlayedDocument;let o=this.applyToLocalView(r,s.mutatedFields);o=e.has(i.key)?null:o;const a=Ho(r,o);null!==a&&n.set(i.key,a),r.isValidDocument()||r.convertToNoDocument(or.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ma())}isEqual(t){return this.batchId===t.batchId&&sr(this.mutations,t.mutations,((t,e)=>Qo(t,e)))&&sr(this.baseMutations,t.baseMutations,((t,e)=>Qo(t,e)))}}class Qa{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Xa{constructor(t,e,n,i,s=or.min(),r=or.min(),o=Cr.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new Xa(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new Xa(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new Xa(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class Ja{constructor(t){this.ne=t}}function Ya(t){const e=Va({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?function(t,e,n){return new To(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(e,e.limit,"L"):e}class Za{constructor(){}re(t,e){this.oe(t,e),e.ue()}oe(t,e){if("nullValue"in t)this.ce(e,5);else if("booleanValue"in t)this.ce(e,10),e.ae(t.booleanValue?1:0);else if("integerValue"in t)this.ce(e,15),e.ae(Rr(t.integerValue));else if("doubleValue"in t){const n=Rr(t.doubleValue);isNaN(n)?this.ce(e,13):(this.ce(e,15),Ur(n)?e.ae(0):e.ae(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ce(e,20),"string"==typeof n?e.he(n):(e.he(`${n.seconds||""}`),e.ae(n.nanos||0))}else if("stringValue"in t)this.le(t.stringValue,e),this.fe(e);else if("bytesValue"in t)this.ce(e,30),e.de(Dr(t.bytesValue)),this.fe(e);else if("referenceValue"in t)this._e(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ce(e,45),e.ae(n.latitude||0),e.ae(n.longitude||0)}else"mapValue"in t?Zr(t)?this.ce(e,Number.MAX_SAFE_INTEGER):(this.we(t.mapValue,e),this.fe(e)):"arrayValue"in t?(this.me(t.arrayValue,e),this.fe(e)):$s()}le(t,e){this.ce(e,25),this.ge(t,e)}ge(t,e){e.he(t)}we(t,e){const n=t.fields||{};this.ce(e,55);for(const t of Object.keys(n))this.le(t,e),this.oe(n[t],e)}me(t,e){const n=t.values||[];this.ce(e,50);for(const t of n)this.oe(t,e)}_e(t,e){this.ce(e,37),lr.fromName(t).path.forEach((t=>{this.ce(e,60),this.ge(t,e)}))}ce(t,e){t.ae(e)}fe(t){t.ae(2)}}Za.ye=new Za;class tc{constructor(){this.ze=new ec}addToCollectionParentIndex(t,e){return this.ze.add(e),mr.resolve()}getCollectionParents(t,e){return mr.resolve(this.ze.getEntries(e))}addFieldIndex(t,e){return mr.resolve()}deleteFieldIndex(t,e){return mr.resolve()}getDocumentsMatchingTarget(t,e){return mr.resolve(null)}getIndexType(t,e){return mr.resolve(0)}getFieldIndexes(t,e){return mr.resolve([])}getNextCollectionGroupToUpdate(t){return mr.resolve(null)}getMinOffset(t,e){return mr.resolve(fr.min())}getMinOffsetFromCollectionGroup(t,e){return mr.resolve(fr.min())}updateCollectionGroup(t,e,n){return mr.resolve()}updateIndexEntries(t,e){return mr.resolve()}}class ec{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Er(cr.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Er(cr.comparator)).toArray()}}new Uint8Array(0);class nc{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new nc(t,nc.DEFAULT_COLLECTION_PERCENTILE,nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}nc.DEFAULT_COLLECTION_PERCENTILE=10,nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nc.DEFAULT=new nc(41943040,nc.DEFAULT_COLLECTION_PERCENTILE,nc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nc.DISABLED=new nc(-1,0,0);class ic{constructor(t){this.En=t}next(){return this.En+=2,this.En}static An(){return new ic(0)}static Rn(){return new ic(-1)}}class sc{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class rc{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(n=i,this.getBaseDocument(t,e,n)))).next((t=>(null!==n&&Wo(n.mutation,t,kr.empty(),rr.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ma()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ma()){const i=da();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,n).next((t=>{let e=ha();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=da();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ma())))}populateOverlays(t,e,n){const i=[];return n.forEach((t=>{e.has(t)||i.push(t)})),this.documentOverlayCache.getOverlays(t,i).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,i){let s=ca();const r=pa(),o=pa();return e.forEach(((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof Jo)?s=s.insert(e.key,e):void 0!==o&&(r.set(e.key,o.mutation.getFieldMask()),Wo(o.mutation,e,o.mutation.getFieldMask(),rr.now()))})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new sc(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=pa();let i=new br(((t,e)=>t-e)),s=ma();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||kr.empty();o=s.applyToLocalView(r,o),n.set(t,o);const a=(i.get(s.batchId)||ma()).add(t);i=i.insert(s.batchId,a)}))})).next((()=>{const r=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,u=fa();c.forEach((t=>{if(!s.has(t)){const i=Ho(e.get(t),n.get(t));null!==i&&u.set(t,i),s=s.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,a,u))}return mr.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return lr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next((s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):mr.resolve(da());let o=-1,a=s;return r.next((e=>mr.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?mr.resolve():this.getBaseDocument(t,e,n).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,ma()))).next((t=>({batchId:o,changes:la(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new lr(e)).next((t=>{let e=ha();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const i=e.collectionGroup;let s=ha();return this.indexManager.getCollectionParents(t,i).next((r=>mr.forEach(r,(r=>{const o=function(t,e){return new To(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(i));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n){let i;return this.remoteDocumentCache.getAllFromCollection(t,e.path,n).next((s=>(i=s,this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId)))).next((t=>{t.forEach(((t,e)=>{const n=e.getKey();null===i.get(n)&&(i=i.insert(n,eo.newInvalidDocument(n)))}));let n=ha();return i.forEach(((i,s)=>{const r=t.get(i);void 0!==r&&Wo(r.mutation,s,kr.empty(),rr.now()),No(e,s)&&(n=n.insert(i,s))})),n}))}getBaseDocument(t,e,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(t,e):mr.resolve(eo.newInvalidDocument(e))}}class oc{constructor(t){this.wt=t,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(t,e){return mr.resolve(this.Jn.get(e))}saveBundleMetadata(t,e){var n;return this.Jn.set(e.id,{id:(n=e).id,version:n.version,createTime:Da(n.createTime)}),mr.resolve()}getNamedQuery(t,e){return mr.resolve(this.Yn.get(e))}saveNamedQuery(t,e){return this.Yn.set(e.name,function(t){return{name:t.name,query:Ya(t.bundledQuery),readTime:Da(t.readTime)}}(e)),mr.resolve()}}class ac{constructor(){this.overlays=new br(lr.comparator),this.Xn=new Map}getOverlay(t,e){return mr.resolve(this.overlays.get(e))}getOverlays(t,e){const n=da();return mr.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,i)=>{this.ie(t,e,i)})),mr.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.Xn.get(n);return void 0!==i&&(i.forEach((t=>this.overlays=this.overlays.remove(t))),this.Xn.delete(n)),mr.resolve()}getOverlaysForCollection(t,e,n){const i=da(),s=e.length+1,r=new lr(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===s&&t.largestBatchId>n&&i.set(t.getKey(),t)}return mr.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new br(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=da(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=da(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=i)););return mr.resolve(o)}ie(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.Xn.get(i.largestBatchId).delete(n.key);this.Xn.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Qa(e,n));let s=this.Xn.get(e);void 0===s&&(s=ma(),this.Xn.set(e,s)),this.Xn.set(e,s.add(n.key))}}class cc{constructor(){this.Zn=new Er(uc.ts),this.es=new Er(uc.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(t,e){const n=new uc(t,e);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.rs(new uc(t,e))}os(t,e){t.forEach((t=>this.removeReference(t,e)))}us(t){const e=new lr(new cr([])),n=new uc(e,t),i=new uc(e,t+1),s=[];return this.es.forEachInRange([n,i],(t=>{this.rs(t),s.push(t.key)})),s}cs(){this.Zn.forEach((t=>this.rs(t)))}rs(t){this.Zn=this.Zn.delete(t),this.es=this.es.delete(t)}hs(t){const e=new lr(new cr([])),n=new uc(e,t),i=new uc(e,t+1);let s=ma();return this.es.forEachInRange([n,i],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new uc(t,0),n=this.Zn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class uc{constructor(t,e){this.key=t,this.ls=e}static ts(t,e){return lr.comparator(t.key,e.key)||ir(t.ls,e.ls)}static ns(t,e){return ir(t.ls,e.ls)||lr.comparator(t.key,e.key)}}class hc{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.fs=1,this.ds=new Er(uc.ts)}checkEmpty(t){return mr.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const s=this.fs;this.fs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Wa(s,e,n,i);this.mutationQueue.push(r);for(const e of i)this.ds=this.ds.add(new uc(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return mr.resolve(r)}lookupMutationBatch(t,e){return mr.resolve(this._s(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.ws(n),s=i<0?0:i;return mr.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return mr.resolve(0===this.mutationQueue.length?-1:this.fs-1)}getAllMutationBatches(t){return mr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new uc(e,0),i=new uc(e,Number.POSITIVE_INFINITY),s=[];return this.ds.forEachInRange([n,i],(t=>{const e=this._s(t.ls);s.push(e)})),mr.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Er(ir);return e.forEach((t=>{const e=new uc(t,0),i=new uc(t,Number.POSITIVE_INFINITY);this.ds.forEachInRange([e,i],(t=>{n=n.add(t.ls)}))})),mr.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let s=n;lr.isDocumentKey(s)||(s=s.child(""));const r=new uc(new lr(s),0);let o=new Er(ir);return this.ds.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.ls)),!0)}),r),mr.resolve(this.gs(o))}gs(t){const e=[];return t.forEach((t=>{const n=this._s(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){zs(0===this.ys(e.batchId,"removed")),this.mutationQueue.shift();let n=this.ds;return mr.forEach(e.mutations,(i=>{const s=new uc(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.ds=n}))}In(t){}containsKey(t,e){const n=new uc(e,0),i=this.ds.firstAfterOrEqual(n);return mr.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,mr.resolve()}ys(t,e){return this.ws(t)}ws(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}_s(t){const e=this.ws(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class lc{constructor(t){this.ps=t,this.docs=new br(lr.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),s=i?i.size:0,r=this.ps(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return mr.resolve(n?n.document.mutableCopy():eo.newInvalidDocument(e))}getEntries(t,e){let n=ca();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():eo.newInvalidDocument(t))})),mr.resolve(n)}getAllFromCollection(t,e,n){let i=ca();const s=new lr(e.child("")),r=this.docs.getIteratorFrom(s);for(;r.hasNext();){const{key:t,value:{document:s}}=r.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||pr(dr(s),n)<=0||(i=i.insert(s.key,s.mutableCopy()))}return mr.resolve(i)}getAllFromCollectionGroup(t,e,n,i){$s()}Is(t,e){return mr.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new dc(this)}getSize(t){return mr.resolve(this.size)}}class dc extends class{constructor(){this.changes=new oa((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,eo.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?mr.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}{constructor(t){super(),this.zn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?e.push(this.zn.addEntry(t,i)):this.zn.removeEntry(n)})),mr.waitFor(e)}getFromCache(t,e){return this.zn.getEntry(t,e)}getAllFromCache(t,e){return this.zn.getEntries(t,e)}}class fc{constructor(t){this.persistence=t,this.Ts=new oa((t=>so(t)),ro),this.lastRemoteSnapshotVersion=or.min(),this.highestTargetId=0,this.Es=0,this.As=new cc,this.targetCount=0,this.Rs=ic.An()}forEachTarget(t,e){return this.Ts.forEach(((t,n)=>e(n))),mr.resolve()}getLastRemoteSnapshotVersion(t){return mr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return mr.resolve(this.Es)}allocateTargetId(t){return this.highestTargetId=this.Rs.next(),mr.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Es&&(this.Es=e),mr.resolve()}vn(t){this.Ts.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Rs=new ic(e),this.highestTargetId=e),t.sequenceNumber>this.Es&&(this.Es=t.sequenceNumber)}addTargetData(t,e){return this.vn(e),this.targetCount+=1,mr.resolve()}updateTargetData(t,e){return this.vn(e),mr.resolve()}removeTargetData(t,e){return this.Ts.delete(e.target),this.As.us(e.targetId),this.targetCount-=1,mr.resolve()}removeTargets(t,e,n){let i=0;const s=[];return this.Ts.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Ts.delete(r),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),mr.waitFor(s).next((()=>i))}getTargetCount(t){return mr.resolve(this.targetCount)}getTargetData(t,e){const n=this.Ts.get(e)||null;return mr.resolve(n)}addMatchingKeys(t,e,n){return this.As.ss(e,n),mr.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const i=this.persistence.referenceDelegate,s=[];return i&&e.forEach((e=>{s.push(i.markPotentiallyOrphaned(t,e))})),mr.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.As.us(e),mr.resolve()}getMatchingKeysForTargetId(t,e){const n=this.As.hs(e);return mr.resolve(n)}containsKey(t,e){return mr.resolve(this.As.containsKey(e))}}class pc{constructor(t,e){this.bs={},this.overlays={},this.Ps=new vr(0),this.vs=!1,this.vs=!0,this.referenceDelegate=t(this),this.Vs=new fc(this),this.indexManager=new tc,this.remoteDocumentCache=function(t){return new lc(t)}((t=>this.referenceDelegate.Ss(t))),this.wt=new Ja(e),this.Ds=new oc(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new ac,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.bs[t.toKey()];return n||(n=new hc(e,this.referenceDelegate),this.bs[t.toKey()]=n),n}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(t,e,n){Vs("MemoryPersistence","Starting transaction:",t);const i=new gc(this.Ps.next());return this.referenceDelegate.Cs(),n(i).next((t=>this.referenceDelegate.xs(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Ns(t,e){return mr.or(Object.values(this.bs).map((n=>()=>n.containsKey(t,e))))}}class gc extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}{constructor(t){super(),this.currentSequenceNumber=t}}class mc{constructor(t){this.persistence=t,this.ks=new cc,this.Os=null}static Ms(t){return new mc(t)}get Fs(){if(this.Os)return this.Os;throw $s()}addReference(t,e,n){return this.ks.addReference(n,e),this.Fs.delete(n.toString()),mr.resolve()}removeReference(t,e,n){return this.ks.removeReference(n,e),this.Fs.add(n.toString()),mr.resolve()}markPotentiallyOrphaned(t,e){return this.Fs.add(e.toString()),mr.resolve()}removeTarget(t,e){this.ks.us(e.targetId).forEach((t=>this.Fs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Fs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Cs(){this.Os=new Set}xs(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return mr.forEach(this.Fs,(n=>{const i=lr.fromPath(n);return this.$s(t,i).next((t=>{t||e.removeEntry(i,or.min())}))})).next((()=>(this.Os=null,e.apply(t))))}updateLimboDocument(t,e){return this.$s(t,e).next((t=>{t?this.Fs.delete(e.toString()):this.Fs.add(e.toString())}))}Ss(t){return 0}$s(t,e){return mr.or([()=>mr.resolve(this.ks.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ns(t,e)])}}class yc{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Pi=n,this.vi=i}static Vi(t,e){let n=ma(),i=ma();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new yc(t,e.fromCache,n,i)}}class vc{constructor(){this.Si=!1}initialize(t,e){this.Di=t,this.indexManager=e,this.Si=!0}getDocumentsMatchingQuery(t,e,n,i){return this.Ci(t,e).next((s=>s||this.xi(t,e,i,n))).next((n=>n||this.Ni(t,e)))}Ci(t,e){return mr.resolve(null)}xi(t,e,n,i){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||i.isEqual(or.min())?this.Ni(t,e):this.Di.getDocuments(t,n).next((s=>{const r=this.ki(e,s);return this.Oi(e,r,n,i)?this.Ni(t,e):(Us()<=N.DEBUG&&Vs("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ao(e)),this.Mi(t,r,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,s=or.fromTimestamp(1e9===i?new rr(n+1,0):new rr(n,i));return new fr(s,lr.empty(),e)}(i,-1)))}))}ki(t,e){let n=new Er(Ro(t));return e.forEach(((e,i)=>{No(t,i)&&(n=n.add(i))})),n}Oi(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ni(t,e){return Us()<=N.DEBUG&&Vs("QueryEngine","Using full collection scan to execute query:",Ao(e)),this.Di.getDocumentsMatchingQuery(t,e,fr.min())}Mi(t,e,n,i){return this.Di.getDocumentsMatchingQuery(t,n,i).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class wc{constructor(t,e,n,i){this.persistence=t,this.Fi=e,this.wt=i,this.$i=new br(ir),this.Bi=new oa((t=>so(t)),ro),this.Li=new Map,this.Ui=t.getRemoteDocumentCache(),this.Vs=t.getTargetCache(),this.Ds=t.getBundleCache(),this.qi(n)}qi(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new rc(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.$i)))}}async function Ic(t,e){const n=Ks(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next((s=>(i=s,n.qi(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],r=[];let o=ma();for(const t of i){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({Ki:t,removedBatchIds:s,addedBatchIds:r})))}))}))}function bc(t){const e=Ks(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Vs.getLastRemoteSnapshotVersion(t)))}async function Tc(t,e,n){const i=Ks(t),s=i.$i.get(e),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,(t=>i.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!yr(t))throw t;Vs("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}i.$i=i.$i.remove(e),i.Bi.delete(s.target)}function _c(t,e,n){const i=Ks(t);let s=or.min(),r=ma();return i.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const i=Ks(t),s=i.Bi.get(n);return void 0!==s?mr.resolve(i.$i.get(s)):i.Vs.getTargetData(e,n)}(i,t,So(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Vs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>i.Fi.getDocumentsMatchingQuery(t,e,n?s:or.min(),n?r:ma()))).next((t=>(function(t,e,n){let i=or.min();n.forEach(((t,e)=>{e.readTime.compareTo(i)>0&&(i=e.readTime)})),t.Li.set(e,i)}(i,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ji:r})))))}class Ec{constructor(){this.activeTargetIds=va()}Xi(t){this.activeTargetIds=this.activeTargetIds.add(t)}Zi(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Yi(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Sc{constructor(){this.Fr=new Ec,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Fr.Xi(t),this.$r[t]||"not-current"}updateQueryState(t,e,n){this.$r[t]=e}removeLocalQueryTarget(t){this.Fr.Zi(t)}isLocalQueryTarget(t){return this.Fr.activeTargetIds.has(t)}clearQueryState(t){delete this.$r[t]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(t){return this.Fr.activeTargetIds.has(t)}start(){return this.Fr=new Ec,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class kc{Br(t){}shutdown(){}}class Cc{constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(t){this.Gr.push(t)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){Vs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Gr)t(0)}Kr(){Vs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Gr)t(1)}static V(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Ac={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Nc{constructor(t){this.jr=t.jr,this.Wr=t.Wr}zr(t){this.Hr=t}Jr(t){this.Yr=t}onMessage(t){this.Xr=t}close(){this.Wr()}send(t){this.jr(t)}Zr(){this.Hr()}eo(t){this.Yr(t)}no(t){this.Xr(t)}}class Rc extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.so=e+"://"+t.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(t,e,n,i,s){const r=this.oo(t,e);Vs("RestConnection","Sending: ",r,n);const o={};return this.uo(o,i,s),this.co(t,r,o,n).then((t=>(Vs("RestConnection","Received: ",t),t)),(e=>{throw Bs("RestConnection",`${t} failed with error: `,e,"url: ",r,"request:",n),e}))}ao(t,e,n,i,s,r){return this.ro(t,e,n,i,s)}uo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+xs,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}oo(t,e){const n=Ac[t];return`${this.so}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}co(t,e,n,i){return new Promise(((s,r)=>{const o=new Ps;o.listenOnce(As.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case Cs.NO_ERROR:const e=o.getResponseJson();Vs("Connection","XHR received:",JSON.stringify(e)),s(e);break;case Cs.TIMEOUT:Vs("Connection",'RPC "'+t+'" timed out'),r(new Gs(Hs.DEADLINE_EXCEEDED,"Request time out"));break;case Cs.HTTP_ERROR:const n=o.getStatus();if(Vs("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Hs).indexOf(e)>=0?e:Hs.UNKNOWN}(t.status);r(new Gs(e,t.message))}else r(new Gs(Hs.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new Gs(Hs.UNAVAILABLE,"Connection failed."));break;default:$s()}}finally{Vs("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(i);o.send(e,"POST",a,n,15)}))}ho(t,e,n){const i=[this.so,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Ss(),h=ks(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(l.xmlHttpFactory=new Ds({})),this.uo(l.initMessageHeaders,e,n),o()||c()||r().indexOf("Electron/")>=0||u()||r().indexOf("MSAppHost/")>=0||a()||(l.httpHeadersOverwriteParam="$httpHeaders");const d=i.join("");Vs("Connection","Creating WebChannel: "+d,l);const f=s.createWebChannel(d,l);let p=!1,g=!1;const m=new Nc({jr:t=>{g?Vs("Connection","Not sending because WebChannel is closed:",t):(p||(Vs("Connection","Opening WebChannel transport."),f.open(),p=!0),Vs("Connection","WebChannel sending:",t),f.send(t))},Wr:()=>f.close()}),y=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return y(f,Os.EventType.OPEN,(()=>{g||Vs("Connection","WebChannel transport opened.")})),y(f,Os.EventType.CLOSE,(()=>{g||(g=!0,Vs("Connection","WebChannel transport closed"),m.eo())})),y(f,Os.EventType.ERROR,(t=>{g||(g=!0,Bs("Connection","WebChannel transport errored:",t),m.eo(new Gs(Hs.UNAVAILABLE,"The operation could not be completed")))})),y(f,Os.EventType.MESSAGE,(t=>{var e;if(!g){const n=t.data[0];zs(!!n);const i=n,s=i.error||(null===(e=i[0])||void 0===e?void 0:e.error);if(s){Vs("Connection","WebChannel received error:",s);const t=s.status;let e=function(t){const e=ia[t];if(void 0!==e)return ra(e)}(t),n=s.message;void 0===e&&(e=Hs.INTERNAL,n="Unknown error status: "+t+" with message "+s.message),g=!0,m.eo(new Gs(e,n)),f.close()}else Vs("Connection","WebChannel received:",n),m.no(n)}})),y(h,Ns.STAT_EVENT,(t=>{t.stat===Rs.PROXY?Vs("Connection","Detected buffering proxy"):t.stat===Rs.NOPROXY&&Vs("Connection","Detected no buffering proxy")})),setTimeout((()=>{m.Zr()}),0),m}}function Dc(){return"undefined"!=typeof document?document:null}function Oc(t){return new Ra(t,!0)}class Pc{constructor(t,e,n=1e3,i=1.5,s=6e4){this.js=t,this.timerId=e,this.lo=n,this.fo=i,this._o=s,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(t){this.cancel();const e=Math.floor(this.wo+this.To()),n=Math.max(0,Date.now()-this.yo),i=Math.max(0,e-n);i>0&&Vs("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.wo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,i,(()=>(this.yo=Date.now(),t()))),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}cancel(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}class Lc extends class{constructor(t,e,n,i,s,r,o,a){this.js=t,this.Ao=n,this.Ro=i,this.bo=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new Pc(t,e)}Do(){return 1===this.state||5===this.state||this.Co()}Co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.xo()}async stop(){this.Do()&&await this.close(0)}No(){this.state=0,this.So.reset()}ko(){this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,(()=>this.Oo())))}Mo(t){this.Fo(),this.stream.send(t)}async Oo(){if(this.Co())return this.close(0)}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}async close(t,e){this.Fo(),this.$o(),this.So.cancel(),this.Po++,4!==t?this.So.reset():e&&e.code===Hs.RESOURCE_EXHAUSTED?(js(e.toString()),js("Using maximum backoff delay to prevent overloading the backend."),this.So.po()):e&&e.code===Hs.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Bo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Jr(e)}Bo(){}auth(){this.state=1;const t=this.Lo(this.Po),e=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Po===e&&this.Uo(t,n)}),(e=>{t((()=>{const t=new Gs(Hs.UNKNOWN,"Fetching auth token failed: "+e.message);return this.qo(t)}))}))}Uo(t,e){const n=this.Lo(this.Po);this.stream=this.Ko(t,e),this.stream.zr((()=>{n((()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,(()=>(this.Co()&&(this.state=3),Promise.resolve()))),this.listener.zr())))})),this.stream.Jr((t=>{n((()=>this.qo(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}xo(){this.state=5,this.So.Io((async()=>{this.state=0,this.start()}))}qo(t){return Vs("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Lo(t){return e=>{this.js.enqueueAndForget((()=>this.Po===t?e():(Vs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}{constructor(t,e,n,i,s,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,r),this.wt=s}Ko(t,e){return this.bo.ho("Listen",t,e)}onMessage(t){this.So.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:$s()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(t,e){return t.dt?(zs(void 0===e||"string"==typeof e),Cr.fromBase64String(e||"")):(zs(void 0===e||e instanceof Uint8Array),Cr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Hs.UNKNOWN:ra(t.code);return new Gs(e,t.message||"")}(o);n=new _a(i,s,r,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=Pa(t,i.document.name),r=Da(i.document.updateTime),o=new to({mapValue:{fields:i.document.fields}}),a=eo.newFoundDocument(s,r,o),c=i.targetIds||[],u=i.removedTargetIds||[];n=new ba(c,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=Pa(t,i.document),r=i.readTime?Da(i.readTime):or.min(),o=eo.newNoDocument(s,r),a=i.removedTargetIds||[];n=new ba([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=Pa(t,i.document),r=i.removedTargetIds||[];n=new ba([],r,s,null)}else{if(!("filter"in e))return $s();{e.filter;const t=e.filter;t.targetId;const i=t.count||0,s=new na(i),r=t.targetId;n=new Ta(r,s)}}return n}(this.wt,t),n=function(t){if(!("targetChange"in t))return or.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?or.min():e.readTime?Da(e.readTime):or.min()}(t);return this.listener.Go(e,n)}Qo(t){const e={};e.database=Ma(this.wt),e.addTarget=function(t,e){let n;const i=e.target;return n=oo(i)?{documents:Fa(t,i)}:{query:Ua(t,i)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=function(t,e){return t.dt?e.toBase64():e.toUint8Array()}(t,e.resumeToken):e.snapshotVersion.compareTo(or.min())>0&&(n.readTime=function(t,e){return t.dt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}(t,e.snapshotVersion.toTimestamp())),n}(this.wt,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return $s()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.wt,t);n&&(e.labels=n),this.Mo(e)}jo(t){const e={};e.database=Ma(this.wt),e.removeTarget=t,this.Mo(e)}}class Mc extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.bo=n,this.wt=i,this.Zo=!1}tu(){if(this.Zo)throw new Gs(Hs.FAILED_PRECONDITION,"The client has already been terminated.")}ro(t,e,n){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.bo.ro(t,e,n,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Hs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Gs(Hs.UNKNOWN,t.toString())}))}ao(t,e,n,i){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.bo.ao(t,e,n,s,r,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Hs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Gs(Hs.UNKNOWN,t.toString())}))}terminate(){this.Zo=!0}}class xc{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve()))))}uu(t){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ru("Offline")))}set(t){this.cu(),this.eu=0,"Online"===t&&(this.su=!1),this.ru(t)}ru(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ou(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(js(e),this.su=!1):Vs("OnlineStateTracker",e)}cu(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}class Fc{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=s,this.du.Br((t=>{n.enqueueAndForget((async()=>{Hc(this)&&(Vs("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Ks(t);e.lu.add(4),await Vc(e),e._u.set("Unknown"),e.lu.delete(4),await Uc(e)}(this))}))})),this._u=new xc(n,i)}}async function Uc(t){if(Hc(t))for(const e of t.fu)await e(!0)}async function Vc(t){for(const e of t.fu)await e(!1)}function jc(t,e){const n=Ks(t);n.hu.has(e.targetId)||(n.hu.set(e.targetId,e),Kc(n)?zc(n):Zc(n).Co()&&qc(n,e))}function Bc(t,e){const n=Ks(t),i=Zc(n);n.hu.delete(e),i.Co()&&$c(n,e),0===n.hu.size&&(i.Co()?i.ko():Hc(n)&&n._u.set("Unknown"))}function qc(t,e){t.wu.Nt(e.targetId),Zc(t).Qo(e)}function $c(t,e){t.wu.Nt(e),Zc(t).jo(e)}function zc(t){t.wu=new Sa({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),te:e=>t.hu.get(e)||null}),Zc(t).start(),t._u.iu()}function Kc(t){return Hc(t)&&!Zc(t).Do()&&t.hu.size>0}function Hc(t){return 0===Ks(t).lu.size}function Gc(t){t.wu=void 0}async function Wc(t){t.hu.forEach(((e,n)=>{qc(t,e)}))}async function Qc(t,e){Gc(t),Kc(t)?(t._u.uu(e),zc(t)):t._u.set("Unknown")}async function Xc(t,e,n){if(t._u.set("Online"),e instanceof _a&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.hu.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.hu.delete(i),t.wu.removeTarget(i))}(t,e)}catch(n){Vs("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Jc(t,n)}else if(e instanceof ba?t.wu.Ut(e):e instanceof Ta?t.wu.zt(e):t.wu.Gt(e),!n.isEqual(or.min()))try{const e=await bc(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.wu.Yt(e);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.hu.get(i);s&&t.hu.set(i,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.hu.get(e);if(!n)return;t.hu.set(e,n.withResumeToken(Cr.EMPTY_BYTE_STRING,n.snapshotVersion)),$c(t,e);const i=new Xa(n.target,e,1,n.sequenceNumber);qc(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Vs("RemoteStore","Failed to raise snapshot:",e),await Jc(t,e)}}async function Jc(t,e,n){if(!yr(e))throw e;t.lu.add(1),await Vc(t),t._u.set("Offline"),n||(n=()=>bc(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Vs("RemoteStore","Retrying IndexedDB access"),await n(),t.lu.delete(1),await Uc(t)}))}async function Yc(t,e){const n=Ks(t);n.asyncQueue.verifyOperationInProgress(),Vs("RemoteStore","RemoteStore received new credentials");const i=Hc(n);n.lu.add(3),await Vc(n),i&&n._u.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.lu.delete(3),await Uc(n)}function Zc(t){return t.mu||(t.mu=function(t,e,n){const i=Ks(t);return i.tu(),new Lc(e,i.bo,i.authCredentials,i.appCheckCredentials,i.wt,n)}(t.datastore,t.asyncQueue,{zr:Wc.bind(null,t),Jr:Qc.bind(null,t),Go:Xc.bind(null,t)}),t.fu.push((async e=>{e?(t.mu.No(),Kc(t)?zc(t):t._u.set("Unknown")):(await t.mu.stop(),Gc(t))}))),t.mu}class tu{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Ws,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,s){const r=Date.now()+n,o=new tu(t,e,r,i,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Gs(Hs.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function eu(t,e){if(js("AsyncQueue",`${e}: ${t}`),yr(t))return new Gs(Hs.UNAVAILABLE,`${e}: ${t}`);throw t}class nu{constructor(t){this.comparator=t?(e,n)=>t(e,n)||lr.comparator(e.key,n.key):(t,e)=>lr.comparator(t.key,e.key),this.keyedMap=ha(),this.sortedSet=new br(this.comparator)}static emptySet(t){return new nu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof nu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new nu;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class iu{constructor(){this.yu=new br(lr.comparator)}track(t){const e=t.doc.key,n=this.yu.get(e);n?0!==t.type&&3===n.type?this.yu=this.yu.insert(e,t):3===t.type&&1!==n.type?this.yu=this.yu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.yu=this.yu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.yu=this.yu.remove(e):1===t.type&&2===n.type?this.yu=this.yu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.yu=this.yu.insert(e,{type:2,doc:t.doc}):$s():this.yu=this.yu.insert(e,t)}pu(){const t=[];return this.yu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class su{constructor(t,e,n,i,s,r,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new su(t,e,nu.emptySet(e),s,n,i,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ko(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class ru{constructor(){this.Iu=void 0,this.listeners=[]}}class ou{constructor(){this.queries=new oa((t=>Co(t)),ko),this.onlineState="Unknown",this.Tu=new Set}}function au(t,e){const n=Ks(t);let i=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.listeners)e.Au(t)&&(i=!0);s.Iu=t}}i&&uu(n)}function cu(t,e,n){const i=Ks(t),s=i.queries.get(e);if(s)for(const t of s.listeners)t.onError(n);i.queries.delete(e)}function uu(t){t.Tu.forEach((t=>{t.next()}))}class hu{constructor(t,e,n){this.query=t,this.Ru=e,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=n||{}}Au(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new su(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.bu?this.vu(t)&&(this.Ru.next(t),e=!0):this.Vu(t,this.onlineState)&&(this.Su(t),e=!0),this.Pu=t,e}onError(t){this.Ru.error(t)}Eu(t){this.onlineState=t;let e=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,t)&&(this.Su(this.Pu),e=!0),e}Vu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.Du&&n||t.docs.isEmpty()&&"Offline"!==e)}vu(t){if(t.docChanges.length>0)return!0;const e=this.Pu&&this.Pu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Su(t){t=su.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.bu=!0,this.Ru.next(t)}}class lu{constructor(t){this.key=t}}class du{constructor(t){this.key=t}}class fu{constructor(t,e){this.query=t,this.Fu=e,this.$u=null,this.current=!1,this.Bu=ma(),this.mutatedKeys=ma(),this.Lu=Ro(t),this.Uu=new nu(this.Lu)}get qu(){return this.Fu}Ku(t,e){const n=e?e.Gu:new iu,i=e?e.Uu:this.Uu;let s=e?e.mutatedKeys:this.mutatedKeys,r=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(((t,e)=>{const u=i.get(t),h=No(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Qu(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Lu(h,a)>0||c&&this.Lu(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(r=r.add(h),s=d?s.add(t):s.delete(t)):(r=r.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{Uu:r,Gu:n,Oi:o,mutatedKeys:s}}Qu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const i=this.Uu;this.Uu=t.Uu,this.mutatedKeys=t.mutatedKeys;const s=t.Gu.pu();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $s()}};return n(t)-n(e)}(t.type,e.type)||this.Lu(t.doc,e.doc))),this.ju(n);const r=e?this.Wu():[],o=0===this.Bu.size&&this.current?1:0,a=o!==this.$u;return this.$u=o,0!==s.length||a?{snapshot:new su(this.query,t.Uu,i,s,t.mutatedKeys,0===o,a,!1),zu:r}:{zu:r}}Eu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new iu,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}Hu(t){return!this.Fu.has(t)&&!!this.Uu.has(t)&&!this.Uu.get(t).hasLocalMutations}ju(t){t&&(t.addedDocuments.forEach((t=>this.Fu=this.Fu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Fu=this.Fu.delete(t))),this.current=t.current)}Wu(){if(!this.current)return[];const t=this.Bu;this.Bu=ma(),this.Uu.forEach((t=>{this.Hu(t.key)&&(this.Bu=this.Bu.add(t.key))}));const e=[];return t.forEach((t=>{this.Bu.has(t)||e.push(new du(t))})),this.Bu.forEach((n=>{t.has(n)||e.push(new lu(n))})),e}Ju(t){this.Fu=t.ji,this.Bu=ma();const e=this.Ku(t.documents);return this.applyChanges(e,!0)}Yu(){return su.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}class pu{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class gu{constructor(t){this.key=t,this.Xu=!1}}class mu{constructor(t,e,n,i,s,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.Zu={},this.tc=new oa((t=>Co(t)),ko),this.ec=new Map,this.nc=new Set,this.sc=new br(lr.comparator),this.ic=new Map,this.rc=new cc,this.oc={},this.uc=new Map,this.cc=ic.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return!0===this.ac}}async function yu(t,e){const n=function(t){const e=Ks(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=wu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Nu.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bu.bind(null,e),e.Zu.Go=au.bind(null,e.eventManager),e.Zu.lc=cu.bind(null,e.eventManager),e}(t);let i,s;const r=n.tc.get(e);if(r)i=r.targetId,n.sharedClientState.addLocalQueryTarget(i),s=r.view.Yu();else{const t=await function(t,e){const n=Ks(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let i;return n.Vs.getTargetData(t,e).next((s=>s?(i=s,mr.resolve(i)):n.Vs.allocateTargetId(t).next((s=>(i=new Xa(e,s,0,t.currentSequenceNumber),n.Vs.addTargetData(t,i).next((()=>i)))))))})).then((t=>{const i=n.$i.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.$i=n.$i.insert(t.targetId,t),n.Bi.set(e,t.targetId)),t}))}(n.localStore,So(e));n.isPrimaryClient&&jc(n.remoteStore,t);const r=n.sharedClientState.addLocalQueryTarget(t.targetId);i=t.targetId,s=await async function(t,e,n,i){t.hc=(e,n,i)=>async function(t,e,n,i){let s=e.view.Ku(n);s.Oi&&(s=await _c(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ku(t,s))));const r=i&&i.targetChanges.get(e.targetId),o=e.view.applyChanges(s,t.isPrimaryClient,r);return Eu(t,e.targetId,o.zu),o.snapshot}(t,e,n,i);const s=await _c(t.localStore,e,!0),r=new fu(e,s.ji),o=r.Ku(s.documents),a=Ia.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState),c=r.applyChanges(o,t.isPrimaryClient,a);Eu(t,n,c.zu);const u=new pu(e,n,r);return t.tc.set(e,u),t.ec.has(n)?t.ec.get(n).push(e):t.ec.set(n,[e]),c.snapshot}(n,e,i,"current"===r)}return s}async function vu(t,e){const n=Ks(t),i=n.tc.get(e),s=n.ec.get(i.targetId);if(s.length>1)return n.ec.set(i.targetId,s.filter((t=>!ko(t,e)))),void n.tc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Tc(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),Bc(n.remoteStore,i.targetId),Tu(n,i.targetId)})).catch(gr)):(Tu(n,i.targetId),await Tc(n.localStore,i.targetId,!0))}async function wu(t,e){const n=Ks(t);try{const t=await function(t,e){const n=Ks(t),i=e.snapshotVersion;let s=n.$i;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Ui.newChangeBuffer({trackRemovals:!0});s=n.$i;const o=[];e.targetChanges.forEach(((r,a)=>{const c=s.get(a);if(!c)return;o.push(n.Vs.removeMatchingKeys(t,r.removedDocuments,a).next((()=>n.Vs.addMatchingKeys(t,r.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(a)?u=u.withResumeToken(Cr.EMPTY_BYTE_STRING,or.min()).withLastLimboFreeSnapshotVersion(or.min()):r.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(r.resumeToken,i)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,r)&&o.push(n.Vs.updateTargetData(t,u))}));let a=ca(),c=ma();if(e.documentUpdates.forEach((i=>{e.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))})),o.push(function(t,e,n){let i=ma(),s=ma();return n.forEach((t=>i=i.add(t))),e.getEntries(t,i).next((t=>{let i=ca();return n.forEach(((n,r)=>{const o=t.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),r.isNoDocument()&&r.version.isEqual(or.min())?(e.removeEntry(n,r.readTime),i=i.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(r),i=i.insert(n,r)):Vs("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{Gi:i,Qi:s}}))}(t,r,e.documentUpdates).next((t=>{a=t.Gi,c=t.Qi}))),!i.isEqual(or.min())){const e=n.Vs.getLastRemoteSnapshotVersion(t).next((e=>n.Vs.setTargetsMetadata(t,t.currentSequenceNumber,i)));o.push(e)}return mr.waitFor(o).next((()=>r.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.$i=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const i=n.ic.get(e);i&&(zs(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?i.Xu=!0:t.modifiedDocuments.size>0?zs(i.Xu):t.removedDocuments.size>0&&(zs(i.Xu),i.Xu=!1))})),await Cu(n,t,e)}catch(t){await gr(t)}}function Iu(t,e,n){const i=Ks(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.tc.forEach(((n,i)=>{const s=i.view.Eu(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Ks(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Eu(e)&&(i=!0)})),i&&uu(n)}(i.eventManager,e),t.length&&i.Zu.Go(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function bu(t,e,n){const i=Ks(t);i.sharedClientState.updateQueryState(e,"rejected",n);const s=i.ic.get(e),r=s&&s.key;if(r){let t=new br(lr.comparator);t=t.insert(r,eo.newNoDocument(r,or.min()));const n=ma().add(r),s=new wa(or.min(),new Map,new Er(ir),t,n);await wu(i,s),i.sc=i.sc.remove(r),i.ic.delete(e),ku(i)}else await Tc(i.localStore,e,!1).then((()=>Tu(i,e,n))).catch(gr)}function Tu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.ec.get(e))t.tc.delete(i),n&&t.Zu.lc(i,n);t.ec.delete(e),t.isPrimaryClient&&t.rc.us(e).forEach((e=>{t.rc.containsKey(e)||_u(t,e)}))}function _u(t,e){t.nc.delete(e.path.canonicalString());const n=t.sc.get(e);null!==n&&(Bc(t.remoteStore,n),t.sc=t.sc.remove(e),t.ic.delete(n),ku(t))}function Eu(t,e,n){for(const i of n)i instanceof lu?(t.rc.addReference(i.key,e),Su(t,i)):i instanceof du?(Vs("SyncEngine","Document no longer in limbo: "+i.key),t.rc.removeReference(i.key,e),t.rc.containsKey(i.key)||_u(t,i.key)):$s()}function Su(t,e){const n=e.key,i=n.path.canonicalString();t.sc.get(n)||t.nc.has(i)||(Vs("SyncEngine","New document in limbo: "+n),t.nc.add(i),ku(t))}function ku(t){for(;t.nc.size>0&&t.sc.size<t.maxConcurrentLimboResolutions;){const e=t.nc.values().next().value;t.nc.delete(e);const n=new lr(cr.fromString(e)),i=t.cc.next();t.ic.set(i,new gu(n)),t.sc=t.sc.insert(n,i),jc(t.remoteStore,new Xa(So(_o(n.path)),i,2,vr.ot))}}async function Cu(t,e,n){const i=Ks(t),s=[],r=[],o=[];i.tc.isEmpty()||(i.tc.forEach(((t,a)=>{o.push(i.hc(a,e,n).then((t=>{if(t){i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),s.push(t);const e=yc.Vi(a.targetId,t);r.push(e)}})))})),await Promise.all(o),i.Zu.Go(s),await async function(t,e){const n=Ks(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>mr.forEach(e,(e=>mr.forEach(e.Pi,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>mr.forEach(e.vi,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!yr(t))throw t;Vs("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.$i.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.$i=n.$i.insert(e,s)}}}(i.localStore,r))}async function Au(t,e){const n=Ks(t);if(!n.currentUser.isEqual(e)){Vs("SyncEngine","User change. New user:",e.toKey());const t=await Ic(n.localStore,e);n.currentUser=e,function(t,e){t.uc.forEach((t=>{t.forEach((t=>{t.reject(new Gs(Hs.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.uc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Cu(n,t.Ki)}}function Nu(t,e){const n=Ks(t),i=n.ic.get(e);if(i&&i.Xu)return ma().add(i.key);{let t=ma();const i=n.ec.get(e);if(!i)return t;for(const e of i){const i=n.tc.get(e);t=t.unionWith(i.view.qu)}return t}}class Ru{constructor(){this.synchronizeTabs=!1}async initialize(t){this.wt=Oc(t.databaseInfo.databaseId),this.sharedClientState=this.dc(t),this.persistence=this._c(t),await this.persistence.start(),this.localStore=this.wc(t),this.gcScheduler=this.mc(t,this.localStore),this.indexBackfillerScheduler=this.gc(t,this.localStore)}mc(t,e){return null}gc(t,e){return null}wc(t){return function(t,e,n,i){return new wc(t,e,n,i)}(this.persistence,new vc,t.initialUser,this.wt)}_c(t){return new pc(mc.Ms,this.wt)}dc(t){return new Sc}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Du{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Iu(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Au.bind(null,this.syncEngine),await async function(t,e){const n=Ks(t);e?(n.lu.delete(2),await Uc(n)):e||(n.lu.add(2),await Vc(n),n._u.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new ou}createDatastore(t){const e=Oc(t.databaseInfo.databaseId),n=(i=t.databaseInfo,new Rc(i));var i;return function(t,e,n,i){return new Mc(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,i=t.asyncQueue,s=t=>Iu(this.syncEngine,t,0),r=Cc.V()?new Cc:new kc,new Fc(e,n,i,s,r);var e,n,i,s,r}createSyncEngine(t,e){return function(t,e,n,i,s,r,o){const a=new mu(t,e,n,i,s,r);return o&&(a.ac=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Ks(t);Vs("RemoteStore","RemoteStore shutting down."),e.lu.add(5),await Vc(e),e.du.shutdown(),e._u.set("Unknown")}(this.remoteStore)}}class Ou{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ic(this.observer.next,t)}error(t){this.observer.error?this.Ic(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Tc(){this.muted=!0}Ic(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Pu{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Ms.UNAUTHENTICATED,this.clientId=class{static I(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const i=nr(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}}.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Vs("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Vs("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Gs(Hs.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Ws;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=eu(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Lu(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){return t.offlineComponents||(Vs("FirestoreClient","Using default OfflineComponentProvider"),await async function(t,e){t.asyncQueue.verifyOperationInProgress(),Vs("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await Ic(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}(t,new Ru)),t.offlineComponents}(t);Vs("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener((t=>Yc(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Yc(e.remoteStore,n))),t.onlineComponents=e}async function Mu(t){const e=await async function(t){return t.onlineComponents||(Vs("FirestoreClient","Using default OnlineComponentProvider"),await Lu(t,new Du)),t.onlineComponents}(t),n=e.eventManager;return n.onListen=yu.bind(null,e.syncEngine),n.onUnlisten=vu.bind(null,e.syncEngine),n}function xu(t,e,n={}){const i=new Ws;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,i,s){const r=new Ou({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=Ks(t),i=e.query;let s=!1;const r=n.queries.get(i);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),s=0===r.listeners.length)}if(s)return n.queries.delete(i),n.onUnlisten(i)}(t,o))),n.fromCache&&"server"===i.source?s.reject(new Gs(Hs.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new hu(n,r,{includeMetadataChanges:!0,Du:!0});return async function(t,e){const n=Ks(t),i=e.query;let s=!1,r=n.queries.get(i);if(r||(s=!0,r=new ru),s)try{r.Iu=await n.onListen(i)}catch(t){const n=eu(t,`Initialization of query '${Ao(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,r),r.listeners.push(e),e.Eu(n.onlineState),r.Iu&&e.Au(r.Iu)&&uu(n)}(t,o)}(await Mu(t),t.asyncQueue,e,n,i))),i.promise}const Fu=new Map;function Uu(t){if(lr.isDocumentKey(t))throw new Gs(Hs.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Vu(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Gs(Hs.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":$s()}(t);throw new Gs(Hs.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class ju{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Gs(Hs.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Gs(Hs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,n,i){if(!0===e&&!0===i)throw new Gs(Hs.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Bu{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ju({}),this._settingsFrozen=!1,t instanceof xr?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Gs(Hs.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xr(t.options.projectId)}(t))}get app(){if(!this._app)throw new Gs(Hs.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Gs(Hs.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ju(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Xs;switch(t.type){case"gapi":const e=t.client;return zs(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Zs(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Gs(Hs.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Fu.get(t);e&&(Vs("ComponentProvider","Removing Datastore"),Fu.delete(t),e.terminate())}(this),Promise.resolve()}}class qu{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new zu(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new qu(this.firestore,t,this._key)}}class $u{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new $u(this.firestore,t,this._query)}}class zu extends $u{constructor(t,e,n){super(t,e,_o(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new qu(this.firestore,null,new lr(t))}withConverter(t){return new zu(this.firestore,t,this._path)}}class Ku{constructor(){this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new Pc(this,"async_queue_retry"),this.Kc=()=>{const t=Dc();t&&Vs("AsyncQueue","Visibility state changed to "+t.visibilityState),this.So.Eo()};const t=Dc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Gc(),this.Qc(t)}enterRestrictedMode(t){if(!this.Fc){this.Fc=!0,this.Uc=t||!1;const e=Dc();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Kc)}}enqueue(t){if(this.Gc(),this.Fc)return new Promise((()=>{}));const e=new Ws;return this.Qc((()=>this.Fc&&this.Uc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Mc.push(t),this.jc())))}async jc(){if(0!==this.Mc.length){try{await this.Mc[0](),this.Mc.shift(),this.So.reset()}catch(t){if(!yr(t))throw t;Vs("AsyncQueue","Operation failed with retryable error: "+t)}this.Mc.length>0&&this.So.Io((()=>this.jc()))}}Qc(t){const e=this.Oc.then((()=>(this.Lc=!0,t().catch((t=>{this.Bc=t,this.Lc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw js("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Lc=!1,t))))));return this.Oc=e,e}enqueueAfterDelay(t,e,n){this.Gc(),this.qc.indexOf(t)>-1&&(e=0);const i=tu.createAndSchedule(this,t,e,n,(t=>this.Wc(t)));return this.$c.push(i),i}Gc(){this.Bc&&$s()}verifyOperationInProgress(){}async zc(){let t;do{t=this.Oc,await t}while(t!==this.Oc)}Hc(t){for(const e of this.$c)if(e.timerId===t)return!0;return!1}Jc(t){return this.zc().then((()=>{this.$c.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.$c)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.zc()}))}Yc(t){this.qc.push(t)}Wc(t){const e=this.$c.indexOf(t);this.$c.splice(e,1)}}class Hu extends Bu{constructor(t,e,n){super(t,e,n),this.type="firestore",this._queue=new Ku,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Gu(this),this._firestoreClient.terminate()}}function Gu(t){var e;const n=t._freezeSettings(),i=function(t,e,n,i){return new Mr(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Pu(t._authCredentials,t._appCheckCredentials,t._queue,i)}class Wu{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Gs(Hs.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new hr(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Qu{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Qu(Cr.fromBase64String(t))}catch(t){throw new Gs(Hs.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Qu(Cr.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Xu{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Gs(Hs.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Gs(Hs.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ir(this._lat,t._lat)||ir(this._long,t._long)}}const Ju=new RegExp("[~\\*/\\[\\]]");function Yu(t,e,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new Gs(Hs.INVALID_ARGUMENT,a+t+c)}class Zu{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new qu(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new th(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(eh("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class th extends Zu{data(){return super.data()}}function eh(t,e){return"string"==typeof e?function(t,e,n){if(e.search(Ju)>=0)throw Yu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Wu(...e.split("."))._internalPath}catch(i){throw Yu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof Wu?e._internalPath:e._delegate._internalPath}class nh{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class ih extends Zu{constructor(t,e,n,i,s,r){super(t,e,n,i,r),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new sh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(eh("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class sh extends ih{data(t={}){return super.data(t)}}class rh{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new nh(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new sh(this._firestore,this._userDataWriter,n.key,n,new nh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Gs(Hs.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new sh(t._firestore,t._userDataWriter,n.doc.key,n.doc,new nh(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const i=new sh(t._firestore,t._userDataWriter,e.doc.key,e.doc,new nh(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,r=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:oh(e.type),doc:i,oldIndex:s,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function oh(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $s()}}class ah extends class{convertValue(t,e="none"){switch(jr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Rr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Dr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw $s()}}convertObject(t,e){const n={};return Ir(t.fields,((t,i)=>{n[t]=this.convertValue(i,e)})),n}convertGeoPoint(t){return new Xu(Rr(t.latitude),Rr(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Pr(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Lr(t));default:return null}}convertTimestamp(t){const e=Nr(t);return new rr(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=cr.fromString(t);zs(Ga(n));const i=new xr(n.get(1),n.get(3)),s=new lr(n.popFirst(5));return i.isEqual(e)||js(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}{constructor(t){super(),this.firestore=t}convertBytes(t){return new Qu(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new qu(this.firestore,null,e)}}!function(t,e=!0){xs="9.9.0",at(new E("firestore",((t,{options:n})=>{const i=t.getProvider("app").getImmediate(),s=new Hu(i,new Js(t.getProvider("auth-internal")),new er(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),s._setSettings(n),s}),"PUBLIC")),ft(Ls,"3.4.12",t),ft(Ls,"3.4.12","esm2017")}(),ft("firebase","9.9.0","app");const ch="@firebase/installations",uh="0.5.12",hh="w:0.5.12",lh=new f("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function dh(t){return t instanceof d&&t.code.includes("request-failed")}function fh({projectId:t}){return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function ph(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function gh(t,e){const n=(await e.json()).error;return lh.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function mh({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function yh(t){const e=await t();return e.status>=500&&e.status<600?t():e}function vh(t){return new Promise((e=>{setTimeout(e,t)}))}const wh=/^[cdef][\w-]{21}$/;function Ih(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var e}(t);return wh.test(e)?e:""}catch(t){return""}}function bh(t){return`${t.appName}!${t.appId}`}const Th=new Map;function _h(t,e){const n=bh(t);Eh(n,e),function(t,e){const n=(!Sh&&"BroadcastChannel"in self&&(Sh=new BroadcastChannel("[Firebase] FID Change"),Sh.onmessage=t=>{Eh(t.data.key,t.data.fid)}),Sh);n&&n.postMessage({key:t,fid:e}),0===Th.size&&Sh&&(Sh.close(),Sh=null)}(n,e)}function Eh(t,e){const n=Th.get(t);if(n)for(const t of n)t(e)}let Sh=null;const kh="firebase-installations-store";let Ch=null;function Ah(){return Ch||(Ch=G("firebase-installations-database",1,{upgrade:(t,e)=>{0===e&&t.createObjectStore(kh)}})),Ch}async function Nh(t,e){const n=bh(t),i=(await Ah()).transaction(kh,"readwrite"),s=i.objectStore(kh),r=await s.get(n);return await s.put(e,n),await i.done,r&&r.fid===e.fid||_h(t,e.fid),e}async function Rh(t){const e=bh(t),n=(await Ah()).transaction(kh,"readwrite");await n.objectStore(kh).delete(e),await n.done}async function Dh(t,e){const n=bh(t),i=(await Ah()).transaction(kh,"readwrite"),s=i.objectStore(kh),r=await s.get(n),o=e(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||r&&r.fid===o.fid||_h(t,o.fid),o}async function Oh(t){let e;const n=await Dh(t.appConfig,(n=>{const i=function(t){return Mh(t||{fid:Ih(),registrationStatus:0})}(n),s=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(lh.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=fh(t),s=mh(t),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={fid:n,authVersion:"FIS_v2",appId:t.appId,sdkVersion:hh},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await yh((()=>fetch(i,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:ph(t.authToken)}}throw await gh("Create Installation",c)}(t,e);return Nh(t.appConfig,n)}catch(n){throw dh(n)&&409===n.customData.serverCode?await Rh(t.appConfig):await Nh(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:Ph(t)}:{installationEntry:e}}(t,i);return e=s.registrationPromise,s.installationEntry}));return""===n.fid?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function Ph(t){let e=await Lh(t.appConfig);for(;1===e.registrationStatus;)await vh(100),e=await Lh(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await Oh(t);return n||e}return e}function Lh(t){return Dh(t,(t=>{if(!t)throw lh.create("installation-not-found");return Mh(t)}))}function Mh(t){return 1===(e=t).registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function xh({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${fh(t)}/${e}/authTokens:generate`}(t,n),s=function(t,{refreshToken:e}){const n=mh(t);return n.append("Authorization",function(t){return`FIS_v2 ${t}`}(e)),n}(t,n),r=e.getImmediate({optional:!0});if(r){const t=await r.getHeartbeatsHeader();t&&s.append("x-firebase-client",t)}const o={installation:{sdkVersion:hh,appId:t.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await yh((()=>fetch(i,a)));if(c.ok)return ph(await c.json());throw await gh("Generate Auth Token",c)}async function Fh(t,e=!1){let n;const i=await Dh(t.appConfig,(i=>{if(!Vh(i))throw lh.create("not-registered");const s=i.authToken;if(!e&&(2===(r=s).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+36e5}(r)))return i;var r;if(1===s.requestStatus)return n=async function(t,e){let n=await Uh(t.appConfig);for(;1===n.authToken.requestStatus;)await vh(100),n=await Uh(t.appConfig);const i=n.authToken;return 0===i.requestStatus?Fh(t,e):i}(t,e),i;{if(!navigator.onLine)throw lh.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await xh(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await Nh(t.appConfig,i),n}catch(n){if(!dh(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Nh(t.appConfig,n)}else await Rh(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function Uh(t){return Dh(t,(t=>{if(!Vh(t))throw lh.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+1e4<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function Vh(t){return void 0!==t&&2===t.registrationStatus}function jh(t){return lh.create("missing-app-config-values",{valueName:t})}const Bh="installations";at(new E(Bh,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw jh("App Configuration");if(!t.name)throw jh("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw jh(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:ct(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),at(new E("installations-internal",(t=>{const e=ct(t.getProvider("app").getImmediate(),Bh).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await Oh(e);return i?i.catch(console.error):Fh(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await Oh(t);e&&await e}(n),(await Fh(n,e)).token}(e,t)}}),"PRIVATE")),ft(ch,uh),ft(ch,uh,"esm2017");const qh="analytics",$h="https://www.googletagmanager.com/gtag/js",zh=new M("@firebase/analytics");function Kh(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Hh=new f("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),Gh=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Wh(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Qh(t,e=Gh,n){const{appId:i,apiKey:s,measurementId:r}=t.options;if(!i)throw Hh.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Hh.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Jh;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),Xh({appId:i,apiKey:s,measurementId:r},o,a,e)}async function Xh(t,{throttleEndTimeMillis:e,backoffCount:n},i,s=Gh){var r,o;const{appId:a,measurementId:c}=t;try{await function(t,e){return new Promise(((n,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(n,s);t.addEventListener((()=>{clearTimeout(r),i(Hh.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(c)return zh.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null===(r=t)||void 0===r?void 0:r.message}]`),{appId:a,measurementId:c};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,s={method:"GET",headers:Wh(i)},r="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(r,s);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Hh.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return s.deleteThrottleMetadata(a),e}catch(e){const r=e;if(!function(t){if(!(t instanceof d&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(r)){if(s.deleteThrottleMetadata(a),c)return zh.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==r?void 0:r.message}]`),{appId:a,measurementId:c};throw e}const u=503===Number(null===(o=null==r?void 0:r.customData)||void 0===o?void 0:o.httpStatus)?T(n,s.intervalMillis,30):T(n,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return s.setThrottleMetadata(a,h),zh.debug(`Calling attemptFetch again in ${u} millis`),Xh(t,h,i,s)}}class Jh{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let Yh,Zh;async function tl(t,e,n,i,s,r,o){var a;const c=Qh(t);c.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&zh.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>zh.error(t))),e.push(c);const u=async function(){var t;if(!h())return zh.warn(Hh.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await l()}catch(e){return zh.warn(Hh.create("indexeddb-unavailable",{errorInfo:null===(t=e)||void 0===t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[d,f]=await Promise.all([c,u]);(function(){const t=window.document.getElementsByTagName("script");for(const e of Object.values(t))if(e.src&&e.src.includes($h))return e;return null})()||function(t,e){const n=document.createElement("script");n.src=`${$h}?l=${t}&id=${e}`,n.async=!0,document.head.appendChild(n)}(r,d.measurementId),Zh&&(s("consent","default",Zh),Zh=void 0),s("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p.origin="firebase",p.update=!0,null!=f&&(p.firebase_id=f),s("config",d.measurementId,p),Yh&&(s("set",Yh),Yh=void 0),d.measurementId}class el{constructor(t){this.app=t}_delete(){return delete nl[this.app.options.appId],Promise.resolve()}}let nl={},il=[];const sl={};let rl,ol,al="dataLayer",cl=!1;function ul(t,e,n){!function(){const t=[];if(a()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=Hh.create("invalid-analytics-context",{errorInfo:e});zh.warn(n.message)}}();const i=t.options.appId;if(!i)throw Hh.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Hh.create("no-api-key");zh.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=nl[i])throw Hh.create("already-exists",{id:i});if(!cl){!function(t){let e=[];Array.isArray(window.dataLayer)?e=window.dataLayer:window.dataLayer=e}();const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,s){let r=function(...t){window.dataLayer.push(arguments)};return window.gtag&&"function"==typeof window.gtag&&(r=window.gtag),window.gtag=function(t,e,n,i){return async function(s,r,o){try{"event"===s?await async function(t,e,n,i,s){try{let r=[];if(s&&s.send_to){let t=s.send_to;Array.isArray(t)||(t=[t]);const i=await Kh(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),s=t&&e[t.appId];if(!s){r=[];break}r.push(s)}}0===r.length&&(r=Object.values(e)),await Promise.all(r),t("event",i,s||{})}catch(t){zh.error(t)}}(t,e,n,r,o):"config"===s?await async function(t,e,n,i,s,r){const o=i[s];try{if(o)await e[o];else{const t=(await Kh(n)).find((t=>t.measurementId===s));t&&await e[t.appId]}}catch(t){zh.error(t)}t("config",s,r)}(t,e,n,i,r,o):"consent"===s?t("consent","update",o):t("set",r)}catch(t){zh.error(t)}}}(r,t,e,n),{gtagCore:r,wrappedGtag:window.gtag}}(nl,il,sl);ol=t,rl=e,cl=!0}return nl[i]=tl(t,il,sl,e,rl,al,n),new el(t)}const hl="@firebase/analytics",ll="0.8.0";function dl(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(t);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(t,i[s])&&(n[i[s]]=t[i[s]])}return n}at(new E(qh,((t,{options:e})=>ul(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),at(new E("analytics-internal",(function(t){try{const e=t.getProvider(qh).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=_(t),async function(t,e,n,i,s){if(s&&s.global)t("event",n,i);else{const s=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:s}))}}(ol,nl[t.app.options.appId],e,n,i).catch((t=>zh.error(t)))}(e,t,n,i)}}catch(t){throw Hh.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),ft(hl,ll),ft(hl,ll,"esm2017"),Object.create,Object.create;const fl=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},pl=new f("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),gl=new M("@firebase/auth");function ml(t,...e){gl.logLevel<=N.ERROR&&gl.error(`Auth (9.9.0): ${t}`,...e)}function yl(t,...e){throw wl(t,...e)}function vl(t,...e){return wl(t,...e)}function wl(t,...e){if("string"!=typeof t){const n=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=t.name),t._errorFactory.create(n,...i)}return pl.create(t,...e)}function Il(t,e,...n){if(!t)throw wl(e,...n)}function bl(t){const e="INTERNAL ASSERTION FAILED: "+t;throw ml(e),new Error(e)}function Tl(t,e){t||bl(e)}const _l=new Map;function El(t){Tl(t instanceof Function,"Expected a class definition");let e=_l.get(t);return e?(Tl(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,_l.set(t,e),e)}function Sl(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function kl(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}class Cl{constructor(t,e){this.shortDelay=t,this.longDelay=e,Tl(e>t,"Short delay should be less than long delay!"),this.isMobile=o()||c()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===kl()||"https:"===kl()||a()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Al(t,e){Tl(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class Nl{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void bl("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void bl("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void bl("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Rl={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Dl=new Cl(3e4,6e4);function Ol(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Pl(t,e,n,i,s={}){return Ll(t,s,(async()=>{let s={},r={};i&&("GET"===e?r=i:s={body:JSON.stringify(i)});const o=y(Object.assign({key:t.config.apiKey},r)).slice(1),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode),Nl.fetch()(xl(t,t.config.apiHost,n,o),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},s))}))}async function Ll(t,e,n){t._canInitEmulator=!1;const i=Object.assign(Object.assign({},Rl),e);try{const e=new Fl(t),s=await Promise.race([n(),e.promise]);e.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw Ul(t,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const e=s.ok?r.errorMessage:r.error.message,[n,o]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ul(t,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw Ul(t,"email-already-in-use",r);if("USER_DISABLED"===n)throw Ul(t,"user-disabled",r);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(t,e,n){const i=Object.assign(Object.assign({},fl()),{[e]:n});return new f("auth","Firebase",i).create(e,{appName:t.name})}(t,a,o);yl(t,a)}}catch(e){if(e instanceof d)throw e;yl(t,"network-request-failed")}}async function Ml(t,e,n,i,s={}){const r=await Pl(t,e,n,i,s);return"mfaPendingCredential"in r&&yl(t,"multi-factor-auth-required",{_serverResponse:r}),r}function xl(t,e,n,i){const s=`${e}${n}?${i}`;return t.config.emulator?Al(t.config,s):`${t.config.apiScheme}://${s}`}class Fl{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(vl(this.auth,"network-request-failed"))),Dl.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ul(t,e,n){const i={appName:t.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=vl(t,e,i);return s.customData._tokenResponse=n,s}function Vl(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}function jl(t){return 1e3*Number(t)}function Bl(t){var e;const[i,s,r]=t.split(".");if(void 0===i||void 0===s||void 0===r)return ml("JWT malformed, contained fewer than 3 sections"),null;try{const t=function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(s);return t?JSON.parse(t):(ml("Failed to decode base64 JWT payload"),null)}catch(t){return ml("Caught error parsing JWT payload as JSON",null===(e=t)||void 0===e?void 0:e.toString()),null}}async function ql(t,e,n=!1){if(n)return e;try{return await e}catch(e){throw e instanceof d&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class $l{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){var t;try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null===(t=e)||void 0===t?void 0:t.code)&&this.schedule(!0))}this.schedule()}}class zl{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=Vl(this.lastLoginAt),this.creationTime=Vl(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Kl(t){var e;const n=t.auth,i=await t.getIdToken(),s=await ql(t,async function(t,e){return Pl(t,"POST","/v1/accounts:lookup",e)}(n,{idToken:i}));Il(null==s?void 0:s.users.length,n,"internal-error");const r=s.users[0];t._notifyReloadListener(r);const o=(null===(e=r.providerUserInfo)||void 0===e?void 0:e.length)?r.providerUserInfo.map((t=>{var{providerId:e}=t,n=dl(t,["providerId"]);return{providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=t.providerData,u=o,[...c.filter((t=>!u.some((e=>e.providerId===t.providerId)))),...u]);var c,u;const h=t.isAnonymous,l=!(t.email&&r.passwordHash||(null==a?void 0:a.length)),d=!!h&&l,f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new zl(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(t,f)}class Hl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Il(t.idToken,"internal-error"),Il(void 0!==t.idToken,"internal-error"),Il(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):function(t){const e=Bl(t);return Il(e,"internal-error"),Il(void 0!==e.exp,"internal-error"),Il(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}async getToken(t,e=!1){return Il(!this.accessToken||this.refreshToken,t,"user-token-expired"),e||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(t,e){const n=await Ll(t,{},(async()=>{const n=y({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,r=xl(t,i,"/v1/token",`key=${s}`),o=await t._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Nl.fetch()(r,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(t,e);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(t,e){const{refreshToken:n,accessToken:i,expirationTime:s}=e,r=new Hl;return n&&(Il("string"==typeof n,"internal-error",{appName:t}),r.refreshToken=n),i&&(Il("string"==typeof i,"internal-error",{appName:t}),r.accessToken=i),s&&(Il("number"==typeof s,"internal-error",{appName:t}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Hl,this.toJSON())}_performRefresh(){return bl("not implemented")}}function Gl(t,e){Il("string"==typeof t||void 0===t,"internal-error",{appName:e})}class Wl{constructor(t){var{uid:e,auth:n,stsTokenManager:i}=t,s=dl(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new $l(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new zl(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const e=await ql(this,this.stsTokenManager.getToken(this.auth,t));return Il(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const n=_(t),i=await n.getIdToken(e),s=Bl(i);Il(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const r="object"==typeof s.firebase?s.firebase:void 0,o=null==r?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:Vl(jl(s.auth_time)),issuedAtTime:Vl(jl(s.iat)),expirationTime:Vl(jl(s.exp)),signInProvider:o||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=_(t);await Kl(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(Il(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){return new Wl(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(t){Il(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await Kl(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await ql(this,async function(t,e){return Pl(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var n,i,s,r,o,a,c,u;const h=null!==(n=e.displayName)&&void 0!==n?n:void 0,l=null!==(i=e.email)&&void 0!==i?i:void 0,d=null!==(s=e.phoneNumber)&&void 0!==s?s:void 0,f=null!==(r=e.photoURL)&&void 0!==r?r:void 0,p=null!==(o=e.tenantId)&&void 0!==o?o:void 0,g=null!==(a=e._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=e.createdAt)&&void 0!==c?c:void 0,y=null!==(u=e.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:b,stsTokenManager:T}=e;Il(v&&T,t,"internal-error");const _=Hl.fromJSON(this.name,T);Il("string"==typeof v,t,"internal-error"),Gl(h,t.name),Gl(l,t.name),Il("boolean"==typeof w,t,"internal-error"),Il("boolean"==typeof I,t,"internal-error"),Gl(d,t.name),Gl(f,t.name),Gl(p,t.name),Gl(g,t.name),Gl(m,t.name),Gl(y,t.name);const E=new Wl({uid:v,auth:t,email:l,emailVerified:w,displayName:h,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:_,createdAt:m,lastLoginAt:y});return b&&Array.isArray(b)&&(E.providerData=b.map((t=>Object.assign({},t)))),g&&(E._redirectEventId=g),E}static async _fromIdTokenResponse(t,e,n=!1){const i=new Hl;i.updateFromServerResponse(e);const s=new Wl({uid:e.localId,auth:t,stsTokenManager:i,isAnonymous:n});return await Kl(s),s}}class Ql{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}Ql.type="NONE";const Xl=Ql;function Jl(t,e,n){return`firebase:${t}:${e}:${n}`}class Yl{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=Jl(this.userKey,i.apiKey,s),this.fullPersistenceKey=Jl("persistence",i.apiKey,s),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Wl._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new Yl(El(Xl),t,n);const i=(await Promise.all(e.map((async t=>{if(await t._isAvailable())return t})))).filter((t=>t));let s=i[0]||El(Xl);const r=Jl(n,t.config.apiKey,t.name);let o=null;for(const n of e)try{const e=await n._get(r);if(e){const i=Wl._fromJSON(t,e);n!==s&&(o=i),s=n;break}}catch(t){}const a=i.filter((t=>t._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(e.map((async t=>{if(t!==s)try{await t._remove(r)}catch(t){}}))),new Yl(s,t,n)):new Yl(s,t,n)}}function Zl(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(id(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(td(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(rd(e))return"Blackberry";if(od(e))return"Webos";if(ed(e))return"Safari";if((e.includes("chrome/")||nd(e))&&!e.includes("edge/"))return"Chrome";if(sd(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(e);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function td(t=r()){return/firefox\//i.test(t)}function ed(t=r()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function nd(t=r()){return/crios\//i.test(t)}function id(t=r()){return/iemobile/i.test(t)}function sd(t=r()){return/android/i.test(t)}function rd(t=r()){return/blackberry/i.test(t)}function od(t=r()){return/webos/i.test(t)}function ad(t=r()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function cd(t=r()){return ad(t)||sd(t)||od(t)||rd(t)||/windows phone/i.test(t)||id(t)}function ud(t,e=[]){let n;switch(t){case"Browser":n=Zl(r());break;case"Worker":n=`${Zl(r())}-${t}`;break;default:n=t}return`${n}/JsCore/9.9.0/${e.length?e.join(","):"FirebaseCore-web"}`}class hd{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=e=>new Promise(((n,i)=>{try{n(t(e))}catch(t){i(t)}}));n.onAbort=e,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){var e;if(this.auth.currentUser===t)return;const n=[];try{for(const e of this.queue)await e(t),e.onAbort&&n.push(e.onAbort)}catch(t){n.reverse();for(const t of n)try{t()}catch(t){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===(e=t)||void 0===e?void 0:e.message})}}}class ld{constructor(t,e,n){this.app=t,this.heartbeatServiceProvider=e,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new fd(this),this.idTokenSubscription=new fd(this),this.beforeStateQueue=new hd(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=pl,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=El(e)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await Yl.create(this,t),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(t){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(t,!0):void 0}async initializeCurrentUser(t){var e;const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,r=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(t);n&&n!==r||!(null==o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(t){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(t)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Il(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){var e;try{await Kl(t)}catch(t){if("auth/network-request-failed"!==(null===(e=t)||void 0===e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const e=t?_(t):null;return e&&Il(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&Il(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(t){return this.queue((async()=>{await this.assertedPersistence.setPersistence(El(t))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new f("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return null===t?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&El(t)||this._popupRedirectResolver;Il(e,this,"argument-error"),this.redirectPersistenceManager=await Yl.create(this,[El(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,i){if(this._deleted)return()=>{};const s="function"==typeof e?e:e.next.bind(e),r=this._isInitialized?Promise.resolve():this._initializationPromise;return Il(r,this,"internal-error"),r.then((()=>s(this.currentUser))),"function"==typeof e?t.addObserver(e,n,i):t.addObserver(e)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&(this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh()),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Il(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=ud(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());return n&&(e["X-Firebase-Client"]=n),e}}function dd(t){return _(t)}class fd{constructor(t){this.auth=t,this.observer=null,this.addObserver=function(t,e){const n=new I(t,void 0);return n.subscribe.bind(n)}((t=>this.observer=t))}get next(){return Il(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class pd{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return bl("not implemented")}_getIdTokenResponse(t){return bl("not implemented")}_linkToIdToken(t,e){return bl("not implemented")}_getReauthenticationResolver(t){return bl("not implemented")}}class gd extends pd{constructor(t,e,n,i=null){super("password",n),this._email=t,this._password=e,this._tenantId=i}static _fromEmailAndPassword(t,e){return new gd(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new gd(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return async function(t,e){return Ml(t,"POST","/v1/accounts:signInWithPassword",Ol(t,e))}(t,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return Ml(t,"POST","/v1/accounts:signInWithEmailLink",Ol(t,e))}(t,{email:this._email,oobCode:this._password});default:yl(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return async function(t,e){return Pl(t,"POST","/v1/accounts:update",e)}(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return Ml(t,"POST","/v1/accounts:signInWithEmailLink",Ol(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:yl(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function md(t,e){return Ml(t,"POST","/v1/accounts:signInWithIdp",Ol(t,e))}class yd extends pd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new yd(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):yl("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:n,signInMethod:i}=e,s=dl(e,["providerId","signInMethod"]);if(!n||!i)return null;const r=new yd(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(t){return md(t,this.buildRequest())}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,md(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,md(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=y(e)}return t}}const vd={USER_NOT_FOUND:"user-not-found"};class wd extends pd{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new wd({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new wd({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return Ml(t,"POST","/v1/accounts:signInWithPhoneNumber",Ol(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const n=await Ml(t,"POST","/v1/accounts:signInWithPhoneNumber",Ol(t,e));if(n.temporaryProof)throw Ul(t,"account-exists-with-different-credential",n);return n}(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return async function(t,e){return Ml(t,"POST","/v1/accounts:signInWithPhoneNumber",Ol(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),vd)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:n,verificationCode:i}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:n,code:i}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:s}=t;return n||e||i||s?new wd({verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class Id{constructor(t){var e,n,i,s,r,o;const a=v(w(t)),c=null!==(e=a.apiKey)&&void 0!==e?e:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);Il(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(r=a.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(t){const e=function(t){const e=v(w(t)).link,n=e?v(w(e)).deep_link_id:null,i=v(w(t)).deep_link_id;return(i?v(w(i)).link:null)||i||n||e||t}(t);try{return new Id(e)}catch(t){return null}}}class bd{constructor(){this.providerId=bd.PROVIDER_ID}static credential(t,e){return gd._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=Id.parseLink(e);return Il(n,"argument-error"),gd._fromEmailAndCode(t,n.code,n.tenantId)}}bd.PROVIDER_ID="password",bd.EMAIL_PASSWORD_SIGN_IN_METHOD="password",bd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Td{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class _d extends Td{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class Ed extends _d{constructor(){super("facebook.com")}static credential(t){return yd._fromParams({providerId:Ed.PROVIDER_ID,signInMethod:Ed.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Ed.credentialFromTaggedObject(t)}static credentialFromError(t){return Ed.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Ed.credential(t.oauthAccessToken)}catch(t){return null}}}Ed.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ed.PROVIDER_ID="facebook.com";class Sd extends _d{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return yd._fromParams({providerId:Sd.PROVIDER_ID,signInMethod:Sd.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return Sd.credentialFromTaggedObject(t)}static credentialFromError(t){return Sd.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return Sd.credential(e,n)}catch(t){return null}}}Sd.GOOGLE_SIGN_IN_METHOD="google.com",Sd.PROVIDER_ID="google.com";class kd extends _d{constructor(){super("github.com")}static credential(t){return yd._fromParams({providerId:kd.PROVIDER_ID,signInMethod:kd.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return kd.credentialFromTaggedObject(t)}static credentialFromError(t){return kd.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return kd.credential(t.oauthAccessToken)}catch(t){return null}}}kd.GITHUB_SIGN_IN_METHOD="github.com",kd.PROVIDER_ID="github.com";class Cd extends _d{constructor(){super("twitter.com")}static credential(t,e){return yd._fromParams({providerId:Cd.PROVIDER_ID,signInMethod:Cd.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return Cd.credentialFromTaggedObject(t)}static credentialFromError(t){return Cd.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return Cd.credential(e,n)}catch(t){return null}}}Cd.TWITTER_SIGN_IN_METHOD="twitter.com",Cd.PROVIDER_ID="twitter.com";class Ad{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,i=!1){const s=await Wl._fromIdTokenResponse(t,n,i),r=Nd(n);return new Ad({user:s,providerId:r,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const i=Nd(n);return new Ad({user:t,providerId:i,_tokenResponse:n,operationType:e})}}function Nd(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Rd extends d{constructor(t,e,n,i){var s;super(e.code,e.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Rd.prototype),this.customData={appName:t.name,tenantId:null!==(s=t.tenantId)&&void 0!==s?s:void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,i){return new Rd(t,e,n,i)}}function Dd(t,e,n,i){return("reauthenticate"===e?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Rd._fromErrorAndOperation(t,n,e,i);throw n}))}new WeakMap;const Od="__sak";class Pd{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(Od,"1"),this.storage.removeItem(Od),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class Ld extends Pd{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const t=r();return ed(t)||ad(t)}()&&function(){try{return!(!window||window===window.top)}catch(t){return!1}}(),this.fallbackToPolling=cd(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),i=this.localCache[e];n!==i&&t(e,i,n)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,n)=>{this.notifyListeners(t,n)}));const n=t.key;if(e?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(t.newValue!==i)null!==t.newValue?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!e)return}const i=()=>{const t=this.storage.getItem(n);(e||this.localCache[n]!==t)&&this.notifyListeners(n,t)},s=this.storage.getItem(n);u()&&10===document.documentMode&&s!==t.newValue&&t.newValue!==t.oldValue?setTimeout(i,10):i()}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}Ld.type="LOCAL";const Md=Ld;class xd extends Pd{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(t,e){}_removeListener(t,e){}}xd.type="SESSION";const Fd=xd;class Ud{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const n=new Ud(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:i,data:s}=e.data,r=this.handlersMap[i];if(!(null==r?void 0:r.size))return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map((async t=>t(e.origin,s))),a=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);e.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Vd(t="",e=10){let n="";for(let t=0;t<e;t++)n+=Math.floor(10*Math.random());return t+n}Ud.receivers=[];class jd{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise(((o,a)=>{const c=Vd("",20);i.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);r={messageChannel:i,onMessage(t){const e=t;if(e.data.eventId===c)switch(e.data.status){case"ack":clearTimeout(u),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(e.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[i.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function Bd(){return window}function qd(){return void 0!==Bd().WorkerGlobalScope&&"function"==typeof Bd().importScripts}const $d="firebaseLocalStorageDb",zd="firebaseLocalStorage",Kd="fbase_key";class Hd{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function Gd(t,e){return t.transaction([zd],e?"readwrite":"readonly").objectStore(zd)}function Wd(){const t=indexedDB.open($d,1);return new Promise(((e,n)=>{t.addEventListener("error",(()=>{n(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(zd,{keyPath:Kd})}catch(t){n(t)}})),t.addEventListener("success",(async()=>{const n=t.result;n.objectStoreNames.contains(zd)?e(n):(n.close(),await function(){const t=indexedDB.deleteDatabase($d);return new Hd(t).toPromise()}(),e(await Wd()))}))}))}async function Qd(t,e,n){const i=Gd(t,!0).put({[Kd]:e,value:n});return new Hd(i).toPromise()}function Xd(t,e){const n=Gd(t,!0).delete(e);return new Hd(n).toPromise()}class Jd{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Wd()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qd()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ud._getInstance(qd()?self:null),this.receiver._subscribe("keyChanged",(async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)}))),this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new jd(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(t=n[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=n[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(this.sender&&this.activeServiceWorker&&function(){var t;return(null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Wd();return await Qd(t,Od,"1"),await Xd(t,Od),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>(await this._withRetries((n=>Qd(n,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async _get(t){const e=await this._withRetries((e=>async function(t,e){const n=Gd(t,!1).get(e),i=await new Hd(n).toPromise();return void 0===i?null:i.value}(e,t)));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite((async()=>(await this._withRetries((e=>Xd(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async _poll(){const t=await this._withRetries((t=>{const e=Gd(t,!1).getAll();return new Hd(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],n=new Set;for(const{fbase_key:i,value:s}of t)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),e.push(i));for(const t of Object.keys(this.localCache))this.localCache[t]&&!n.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Jd.type="LOCAL";const Yd=Jd;function Zd(t){return`__${t}${Math.floor(1e6*Math.random())}`}Zd("rcb"),new Cl(3e4,6e4);class tf{constructor(t){this.providerId=tf.PROVIDER_ID,this.auth=dd(t)}verifyPhoneNumber(t,e){return async function(t,e,n){var i;const s=await n.verify();try{let r;if(Il("string"==typeof s,t,"argument-error"),Il("recaptcha"===n.type,t,"argument-error"),r="string"==typeof e?{phoneNumber:e}:e,"session"in r){const e=r.session;if("phoneNumber"in r){Il("enroll"===e.type,t,"internal-error");const n=await function(t,e){return Pl(t,"POST","/v2/accounts/mfaEnrollment:start",Ol(t,e))}(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{Il("signin"===e.type,t,"internal-error");const n=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;Il(n,t,"missing-multi-factor-info");const o=await function(t,e){return Pl(t,"POST","/v2/accounts/mfaSignIn:start",Ol(t,e))}(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:e}=await async function(t,e){return Pl(t,"POST","/v1/accounts:sendVerificationCode",Ol(t,e))}(t,{phoneNumber:r.phoneNumber,recaptchaToken:s});return e}}finally{n._reset()}}(this.auth,t,_(e))}static credential(t,e){return wd._fromVerification(t,e)}static credentialFromResult(t){const e=t;return tf.credentialFromTaggedObject(e)}static credentialFromError(t){return tf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:n}=t;return e&&n?wd._fromTokenResponse(e,n):null}}tf.PROVIDER_ID="phone",tf.PHONE_SIGN_IN_METHOD="phone";class ef extends pd{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return md(t,this._buildIdpRequest())}_linkToIdToken(t,e){return md(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return md(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function nf(t){return async function(t,e,n=!1){const i="signIn",s=await Dd(t,i,e),r=await Ad._fromIdTokenResponse(t,i,s);return n||await t._updateCurrentUser(r.user),r}(t.auth,new ef(t),t.bypassAuthState)}function sf(t){const{auth:e,user:n}=t;return Il(n,e,"internal-error"),async function(t,e,n=!1){var i;const{auth:s}=t,r="reauthenticate";try{const i=await ql(t,Dd(s,r,e,t),n);Il(i.idToken,s,"internal-error");const o=Bl(i.idToken);Il(o,s,"internal-error");const{sub:a}=o;return Il(t.uid===a,s,"user-mismatch"),Ad._forOperation(t,r,i)}catch(t){throw"auth/user-not-found"===(null===(i=t)||void 0===i?void 0:i.code)&&yl(s,"user-mismatch"),t}}(n,new ef(t),t.bypassAuthState)}async function rf(t){const{auth:e,user:n}=t;return Il(n,e,"internal-error"),async function(t,e,n=!1){const i=await ql(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ad._forOperation(t,"link",i)}(n,new ef(t),t.bypassAuthState)}class of{constructor(t,e,n,i,s=!1){this.auth=t,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=t;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:e,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return nf;case"linkViaPopup":case"linkViaRedirect":return rf;case"reauthViaPopup":case"reauthViaRedirect":return sf;default:yl(this.auth,"internal-error")}}resolve(t){Tl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Tl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const af=new Cl(2e3,1e4);class cf extends of{constructor(t,e,n,i,s){super(t,e,i,s),this.provider=n,this.authWindow=null,this.pollId=null,cf.currentPopupAction&&cf.currentPopupAction.cancel(),cf.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Il(t,this.auth,"internal-error"),t}async onExecution(){Tl(1===this.filter.length,"Popup operations only handle one event");const t=Vd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)})),this.resolver._isIframeWebStorageSupported(this.auth,(t=>{t||this.reject(vl(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(vl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,cf.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,n;(null===(n=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(vl(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(t,af.get())};t()}}cf.currentPopupAction=null;const uf=new Map;class hf extends of{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=uf.get(this.auth._key());if(!t){try{const e=await async function(t,e){const n=function(t){return Jl("pendingRedirect",t.config.apiKey,t.name)}(e),i=function(t){return El(t._redirectPersistence)}(t);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth),n=e?await super.execute():null;t=()=>Promise.resolve(n)}catch(e){t=()=>Promise.reject(e)}uf.set(this.auth._key(),t)}return this.bypassAuthState||uf.set(this.auth._key(),(()=>Promise.resolve(null))),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function lf(t,e){uf.set(t._key(),e)}async function df(t,e,n=!1){const i=dd(t),s=function(t,e){return e?El(e):(Il(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}(i,e),r=new hf(i,s,n),o=await r.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}class ff{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return gf(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var n;if(t.error&&!gf(t)){const i=(null===(n=t.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";e.onError(vl(this.auth,i))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(pf(t))}saveEventToCache(t){this.cachedEventUids.add(pf(t)),this.lastProcessedEventTime=Date.now()}}function pf(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function gf({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}const mf=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yf=/^https?/;function vf(t){const e=Sl(),{protocol:n,hostname:i}=new URL(e);if(t.startsWith("chrome-extension://")){const s=new URL(t);return""===s.hostname&&""===i?"chrome-extension:"===n&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!yf.test(n))return!1;if(mf.test(t))return i===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const wf=new Cl(3e4,6e4);function If(){const t=Bd().___jsl;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let bf=null;function Tf(t){return bf=bf||function(t){return new Promise(((e,n)=>{var i,s,r,o;function a(){If(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{If(),n(vl(t,"network-request-failed"))},timeout:wf.get()})}if(null===(s=null===(i=Bd().gapi)||void 0===i?void 0:i.iframes)||void 0===s?void 0:s.Iframe)e(gapi.iframes.getContext());else{if(!(null===(r=Bd().gapi)||void 0===r?void 0:r.load)){const e=Zd("iframefcb");return Bd()[e]=()=>{gapi.load?a():n(vl(t,"network-request-failed"))},(o=`https://apis.google.com/js/api.js?onload=${e}`,new Promise(((t,e)=>{const n=document.createElement("script");n.setAttribute("src",o),n.onload=t,n.onerror=t=>{const n=vl("internal-error");n.customData=t,e(n)},n.type="text/javascript",n.charset="UTF-8",function(){var t,e;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(n)}))).catch((t=>n(t)))}a()}})).catch((t=>{throw bf=null,t}))}(t),bf}const _f=new Cl(5e3,15e3),Ef={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Sf=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function kf(t){const e=t.config;Il(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Al(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,i={apiKey:e.apiKey,appName:t.name,v:lt},s=Sf.get(t.config.apiHost);s&&(i.eid=s);const r=t._getFrameworks();return r.length&&(i.fw=r.join(",")),`${n}?${y(i).slice(1)}`}const Cf={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Af{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}function Nf(t,e,n,i,s,r){Il(t.config.authDomain,t,"auth-domain-config-required"),Il(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:i,v:lt,eventId:s};if(e instanceof Td){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(r||{}))o[t]=e}if(e instanceof _d){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(o.scopes=t.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const t of Object.keys(a))void 0===a[t]&&delete a[t];return`${function({config:t}){return t.emulator?Al(t,"emulator/auth/handler"):`https://${t.authDomain}/__/auth/handler`}(t)}?${y(a).slice(1)}`}const Rf="webStorageSupport",Df=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Fd,this._completeRedirectFn=df,this._overrideRedirectResult=lf}async _openPopup(t,e,n,i){var s;return Tl(null===(s=this.eventManagers[t._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(t,e,n,i=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Cf),{width:i.toString(),height:s.toString(),top:o,left:a}),h=r().toLowerCase();n&&(c=nd(h)?"_blank":n),td(h)&&(e=e||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce(((t,[e,n])=>`${t}${e}=${n},`),"");if(function(t=r()){var e;return ad(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(h)&&"_self"!==c)return function(t,e){const n=document.createElement("a");n.href=t,n.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(e||"",c),new Af(null);const d=window.open(e||"",c,l);Il(d,t,"popup-blocked");try{d.focus()}catch(t){}return new Af(d)}(t,Nf(t,e,n,Sl(),i),Vd())}async _openRedirect(t,e,n,i){var s;return await this._originValidation(t),s=Nf(t,e,n,Sl(),i),Bd().location.href=s,new Promise((()=>{}))}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:n}=this.eventManagers[e];return t?Promise.resolve(t):(Tl(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch((()=>{delete this.eventManagers[e]})),n}async initAndGetManager(t){const e=await async function(t){const e=await Tf(t),n=Bd().gapi;return Il(n,t,"internal-error"),e.open({where:document.body,url:kf(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ef,dontclear:!0},(e=>new Promise((async(n,i)=>{await e.restyle({setHideOnLeave:!1});const s=vl(t,"network-request-failed"),r=Bd().setTimeout((()=>{i(s)}),_f.get());function o(){Bd().clearTimeout(r),n(e)}e.ping(o).then(o,(()=>{i(s)}))}))))}(t),n=new ff(t);return e.register("authEvent",(e=>(Il(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(Rf,{type:Rf},(n=>{var i;const s=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i.webStorageSupport;void 0!==s&&e(!!s),yl(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return Pl(t,"GET","/v1/projects",e)}(t);for(const t of e)try{if(vf(t))return}catch(t){}yl(t,"unauthorized-domain")}(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return cd()||ed()||ad()}};var Of,Pf="@firebase/auth",Lf="0.20.5";class Mf{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{var n;t((null===(n=e)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Il(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}Of="Browser",at(new E("auth",((t,{options:e})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),{apiKey:s,authDomain:r}=n.options;return((t,n)=>{Il(s&&!s.includes(":"),"invalid-api-key",{appName:t.name}),Il(!(null==r?void 0:r.includes(":")),"argument-error",{appName:t.name});const i={apiKey:s,authDomain:r,clientPlatform:Of,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ud(Of)},o=new ld(t,n,i);return function(t,e){const n=(null==e?void 0:e.persistence)||[],i=(Array.isArray(n)?n:[n]).map(El);(null==e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(i,null==e?void 0:e.popupRedirectResolver)}(o,e),o})(n,i)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,n)=>{t.getProvider("auth-internal").initialize()}))),at(new E("auth-internal",(t=>(t=>new Mf(t))(dd(t.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),ft(Pf,Lf,void 0),ft(Pf,Lf,"esm2017");const xf="firebasestorage.googleapis.com";class Ff extends d{constructor(t,e){super(Uf(t),`Firebase Storage: ${e} (${Uf(t)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ff.prototype)}_codeEquals(t){return Uf(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function Uf(t){return"storage/"+t}function Vf(t){return new Ff("invalid-argument",t)}function jf(){return new Ff("app-deleted","The Firebase app was deleted.")}class Bf{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=Bf.makeFromUrl(t,e)}catch(e){return new Bf(t,"")}if(""===n.path)return n;throw new Ff("invalid-default-bucket","Invalid default bucket '"+t+"'.")}static makeFromUrl(t,e){let n=null;const i="([A-Za-z0-9.\\-_]+)",s=new RegExp("^gs://"+i+"(/(.*))?$","i");function r(t){t.path_=decodeURIComponent(t.path)}const o=e.replace(/[.]/g,"\\."),a=[{regex:s,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:r},{regex:new RegExp(`^https?://${e===xf?"(?:storage.googleapis.com|storage.cloud.google.com)":e}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:r}];for(let e=0;e<a.length;e++){const i=a[e],s=i.regex.exec(t);if(s){const t=s[i.indices.bucket];let e=s[i.indices.path];e||(e=""),n=new Bf(t,e),i.postModify(n);break}}if(null==n)throw function(t){return new Ff("invalid-url","Invalid URL '"+t+"'.")}(t);return n}}class qf{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}function $f(t,e,n,i){if(i<e)throw Vf(`Invalid value for '${t}'. Expected ${e} or greater.`);if(i>n)throw Vf(`Invalid value for '${t}'. Expected ${n} or less.`)}var zf;!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(zf||(zf={}));class Kf{constructor(t,e,n,i,s,r,o,a,c,u,h){this.url_=t,this.method_=e,this.headers_=n,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=r,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((t,e)=>{this.resolve_=t,this.reject_=e,this.start_()}))}start_(){const t=(t,e)=>{const n=this.resolve_,i=this.reject_,s=e.connection;if(e.wasSuccessCode)try{const t=this.callback_(s,s.getResponse());!function(t){return void 0!==t}(t)?n():n(t)}catch(t){i(t)}else if(null!==s){const t=new Ff("unknown","An unknown error occurred, please check the error payload for server response.");t.serverResponse=s.getErrorText(),this.errorCallback_?i(this.errorCallback_(s,t)):i(t)}else e.canceled?i(this.appDelete_?jf():new Ff("canceled","User canceled the upload/download.")):i(new Ff("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))};this.canceled_?t(0,new Hf(!1,null,!0)):this.backoffId_=function(t,e,n){let i=1,s=null,r=null,o=!1,a=0;function c(){return 2===a}let u=!1;function h(...t){u||(u=!0,e.apply(null,t))}function l(e){s=setTimeout((()=>{s=null,t(f,c())}),e)}function d(){r&&clearTimeout(r)}function f(t,...e){if(u)return void d();if(t)return d(),void h.call(null,t,...e);if(c()||o)return d(),void h.call(null,t,...e);let n;i<64&&(i*=2),1===a?(a=2,n=0):n=1e3*(i+Math.random()),l(n)}let p=!1;function g(t){p||(p=!0,d(),u||(null!==s?(t||(a=2),clearTimeout(s),l(0)):t||(a=1)))}return l(0),r=setTimeout((()=>{o=!0,g(!0)}),n),g}(((t,e)=>{if(e)return void t(!1,new Hf(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=t=>{const e=t.loaded,n=t.lengthComputable?t.total:-1;null!==this.progressCallback_&&this.progressCallback_(e,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const e=n.getErrorCode()===zf.NO_ERROR,s=n.getStatus();if(!e||this.isRetryStatusCode_(s)){const e=n.getErrorCode()===zf.ABORT;return void t(!1,new Hf(!1,null,e))}const r=-1!==this.successCodes_.indexOf(s);t(!0,new Hf(r,n))}))}),t,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(t){const e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),i=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||i}}class Hf{constructor(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}class Gf{constructor(t,e){this._service=t,this._location=e instanceof Bf?e:Bf.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new Gf(t,e)}get root(){const t=new Bf(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(t){const e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}(this._location.path)}get storage(){return this._service}get parent(){const t=function(t){if(0===t.length)return null;const e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===t)return null;const e=new Bf(this._location.bucket,t);return new Gf(this._service,e)}_throwIfRoot(t){if(""===this._location.path)throw function(t){return new Ff("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)}}function Wf(t,e){const n=null==e?void 0:e.storageBucket;return null==n?null:Bf.makeFromBucketSpec(n,t)}class Qf{constructor(t,e,n,i,s){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=xf,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?Bf.makeFromBucketSpec(i,this._host):Wf(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,null!=this._url?this._bucket=Bf.makeFromBucketSpec(this._url,t):this._bucket=Wf(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){$f("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){$f("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(null!==e)return e.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((t=>t.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Gf(this,t)}_makeRequest(t,e,n,i){if(this._deleted)return new qf(jf());{const s=function(t,e,n,i,s,r){const o=function(t){const e=encodeURIComponent;let n="?";for(const i in t)t.hasOwnProperty(i)&&(n=n+(e(i)+"=")+e(t[i])+"&");return n=n.slice(0,-1),n}(t.urlParams),a=t.url+o,c=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(c,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(c,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(c,r),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(c,i),new Kf(a,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s)}(t,this._appId,n,i,e,this._firebaseVersion);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(t,e){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n,i).getPromise()}}const Xf="@firebase/storage",Jf="0.9.9",Yf="storage";var Zf,tp,ep,np,ip,sp;at(new E(Yf,(function(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new Qf(n,i,s,e,lt)}),"PUBLIC").setMultipleInstances(!0)),ft(Xf,Jf,""),ft(Xf,Jf,"esm2017");const rp={apiKey:"AIzaSyBvd9S50ayvisTxaVQR4c7tjkEBN3rdO3Q",authDomain:"underground-eve.firebaseapp.com",projectId:"underground-eve",storageBucket:"underground-eve.appspot.com",messagingSenderId:"1041403011395",appId:"1:1041403011395:web:d1a08391beef5a0bfdcff6",measurementId:"G-W4HDN06V2R"};sp=function(t=dt()){return ct(t,"firestore").getImmediate()}(tp=function(t,e={}){"object"!=typeof e&&(e={name:e});const n=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},e),i=n.name;if("string"!=typeof i||!i)throw ut.create("bad-app-name",{appName:String(i)});const s=st.get(i);if(s){if(g(t,s.options)&&g(n,s.config))return s;throw ut.create("duplicate-app",{appName:i})}const r=new C(i);for(const t of rt.values())r.addComponent(t);const o=new ht(t,n,r);return st.set(i,o),o}(rp)),np=function(t=dt()){const e=ct(t,"auth");return e.isInitialized()?e.getImmediate():function(t,e){const n=ct(t,"auth");if(n.isInitialized()){const t=n.getImmediate();if(g(n.getOptions(),null!=e?e:{}))return t;yl(t,"already-initialized")}return n.initialize({options:e})}(t,{popupRedirectResolver:Df,persistence:[Yd,Md,Fd]})}(tp),ip=function(t=dt(),e){return ct(t=_(t),Yf).getImmediate({identifier:e})}(tp),ep=function(t=dt()){const e=ct(t=_(t),qh);return e.isInitialized()?e.getImmediate():function(t,e={}){const n=ct(t,qh);if(n.isInitialized()){const t=n.getImmediate();if(g(e,n.getOptions()))return t;throw Hh.create("already-initialized")}return n.initialize({options:e})}(t)}(tp),function(){let t=JSON.parse(localStorage.getItem("we_user"));t||async function(t){var e;const n=dd(t);if(await n._initializationPromise,null===(e=n.currentUser)||void 0===e?void 0:e.isAnonymous)return new Ad({user:n.currentUser,providerId:null,operationType:"signIn"});const i=await async function(t,e){return Ml(t,"POST","/v1/accounts:signUp",Ol(t,e))}(n,{returnSecureToken:!0}),s=await Ad._fromIdTokenResponse(n,"signIn",i,!0);return await n._updateCurrentUser(s.user),s}(np).then((async t=>{let e=await JSON.stringify(t),n=await JSON.stringify(rp);await localStorage.setItem("we_user",e),await localStorage.setItem("we_config",n)})).catch((t=>!1))}(),Zf={app:tp,analytics:ep,database:sp,auth:np,storage:ip};var op=null;!async function(){op=await Zf,await async function(t){(function(t){t=Vu(t,$u);const e=Vu(t.firestore,Hu),n=function(t){return t._firestoreClient||Gu(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(e),i=new ah(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Gs(Hs.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),xu(n,t._query).then((n=>new rh(e,i,t,n)))})(function(t,e,...n){if(t=_(t),function(t,e,n){if(!n)throw new Gs(Hs.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("collection","path",e),t instanceof Bu){const i=cr.fromString(e,...n);return Uu(i),new zu(t,null,i)}{if(!(t instanceof qu||t instanceof zu))throw new Gs(Hs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(cr.fromString(e,...n));return Uu(i),new zu(t.firestore,null,i)}}(t.database,"/events")).then((t=>{if(t){let e=0;t.docs.forEach((t=>{e++;const n=document.querySelector("#injbody");let i=t.data(),s=document.createElement("div");s.id="open_click",s.addEventListener("click",(()=>{localStorage.removeItem("show"),localStorage.setItem("show",JSON.stringify({type:"events",item:t.id})),window.location.href="cardDisplay.html"}));let r=document.createElement("div");r.setAttribute("class","blog-card");let o=document.createElement("img");i.Cover&&(o.src=i.Cover);let a=document.createElement("div");a.setAttribute("class","title-content");let c=document.createElement("h3");c.innerHTML=i.title;let u=document.createElement("div");u.setAttribute("class","intro"),u.innerHTML="Basement Inspiration";let h=document.createElement("div");h.setAttribute("class","card-info");let l=document.createElement("a");l.href="#",l.innerHTML="More about this event";let d=document.createElement("div");d.setAttribute("class","gradient-overlay");let f=document.createElement("div");f.setAttribute("class","color-overlay"),a.appendChild(c),a.appendChild(u),h.appendChild(l),r.appendChild(o),r.appendChild(a),r.appendChild(h),r.appendChild(d),r.appendChild(f),s.appendChild(r),n.appendChild(s)}))}}))}(op)}()})();